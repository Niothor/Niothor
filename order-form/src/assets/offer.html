<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Î ÏÎ¿ÏƒÏ†Î¿ÏÎ­Ï‚ App</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent; }
:root {
  --bg:#0F1923; --card:#1A2736; --border:#243447;
  --accent:#E8A23A; --text:#F0EDE8; --muted:#8A9BB0;
  --green:#7ABF7A; --greenbg:#1A2F1A; --greenborder:#2D5C2D;
  --blue:#5B9BD5; --bluebg:#1A2436; --blueborder:#2D4060;
  --subcat:#1F3147; --error:#E85454;
}
html, body { background:var(--bg); font-family:-apple-system,'Segoe UI',sans-serif; color:var(--text); }

.phone-shell { max-width:600px; margin:0 auto; padding-bottom:80px; }

.screen { display:none; }
.screen.active { display:block; }

.scroll-area { padding:0 16px 32px; }

.screen-header { padding:16px 20px 12px; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; background:var(--bg); z-index:10; border-bottom:1px solid var(--border); margin-bottom:12px; }
.screen-title { color:var(--text); font-size:22px; font-weight:800; }
.back-btn { color:var(--accent); font-size:17px; font-weight:600; background:none; border:none; cursor:pointer; padding:6px 10px; }

.section-label { color:var(--muted); font-size:11px; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; margin:10px 0 7px; }

.info-card { background:var(--card); border:1px solid var(--border); border-radius:12px; margin-bottom:14px; overflow:hidden; }
.field-row { display:flex; align-items:center; padding:13px 16px; border-bottom:1px solid var(--border); }
.field-row:last-child { border-bottom:none; }
.field-label { flex:1; color:var(--text); font-size:15px; font-weight:500; }
.field-input { flex:1.2; background:none; border:none; outline:none; color:var(--text); font-size:15px; text-align:right; font-family:inherit; }
.field-input::placeholder { color:var(--muted); }
/* ÎšÏÏÎ²ÎµÎ¹ Ï„Î± Î²ÎµÎ»Î¬ÎºÎ¹Î± Î±Ï€ÏŒ Ï„Î± Ï€ÎµÎ´Î¯Î± Î±ÏÎ¹Î¸Î¼ÏÎ½ */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button { -webkit-appearance:none; margin:0; }
input[type=number] { -moz-appearance:textfield; }
textarea.field-input { text-align:left; resize:none; padding:14px; min-height:70px; display:block; width:100%; }

/* DROPDOWN */
.dropdown-wrap { background:var(--card); border:1px solid var(--border); border-radius:12px; overflow:hidden; margin-bottom:14px; }
.dropdown-selected { display:flex; align-items:center; justify-content:space-between; padding:13px 16px; cursor:pointer; }
.dropdown-placeholder { color:var(--muted); font-size:15px; }
.dropdown-sel-main { color:var(--text); font-size:15px; font-weight:600; }
.dropdown-sel-sub  { color:var(--green); font-size:12px; margin-top:2px; }
.dropdown-chevron  { color:var(--accent); font-size:18px; font-weight:700; transition:transform .2s; flex-shrink:0; }
.dropdown-chevron.open { transform:rotate(90deg); }
.dropdown-list { display:none; border-top:1px solid var(--border); }
.dropdown-list.open { display:block; }
.dropdown-option { display:flex; align-items:center; justify-content:space-between; padding:12px 20px; border-bottom:1px solid var(--border); cursor:pointer; transition:background .12s; }
.dropdown-option:last-child { border-bottom:none; }
.dropdown-option:hover { background:rgba(232,162,58,.07); }
.dropdown-option.active { background:rgba(122,191,122,.08); }
.dopt-name  { color:var(--text); font-size:14px; }
.dopt-price { color:var(--muted); font-size:12px; }
.dropdown-option.active .dopt-name  { color:var(--green); font-weight:700; }
.dropdown-option.active .dopt-price { color:var(--green); }
.dopt-check { color:var(--green); font-weight:700; opacity:0; font-size:14px; }
.dropdown-option.active .dopt-check { opacity:1; }

/* TOGGLE (optional items) */
.toggle-row { display:flex; align-items:center; justify-content:space-between; padding:13px 16px; border-bottom:1px solid var(--border); }
.toggle-row:last-child { border-bottom:none; }
.toggle-label { color:var(--text); font-size:15px; font-weight:500; flex:1; }
.toggle-sub { color:var(--muted); font-size:12px; margin-top:1px; }
.toggle-switch { width:44px; height:26px; background:var(--border); border-radius:13px; position:relative; cursor:pointer; transition:background .2s; flex-shrink:0; }
.toggle-switch.on { background:var(--accent); }
.toggle-knob { width:20px; height:20px; background:white; border-radius:10px; position:absolute; top:3px; left:3px; transition:transform .2s; }
.toggle-switch.on .toggle-knob { transform:translateX(18px); }

/* SETA QUESTION */
.seta-question { background:#1C2A3A; border:1px solid var(--accent); border-radius:12px; padding:16px; margin-bottom:14px; }
.seta-q-title { color:var(--accent); font-size:13px; font-weight:700; margin-bottom:12px; }
.seta-options { display:flex; gap:8px; flex-wrap:wrap; }
.seta-opt { background:var(--border); border:1.5px solid var(--border); border-radius:10px; padding:10px 16px; cursor:pointer; color:var(--text); font-size:15px; font-weight:600; transition:all .15s; }
.seta-opt:hover { border-color:var(--accent); }
.seta-opt.active { background:rgba(232,162,58,.15); border-color:var(--accent); color:var(--accent); }
.simple-list { display:flex; flex-direction:column; gap:4px; }
.simple-pill { background:var(--border); border:1.5px solid var(--border); border-radius:8px; padding:6px 10px; cursor:pointer; color:var(--text); font-size:13px; text-align:left; transition:all .15s; white-space:nowrap; }
.simple-pill:hover { border-color:var(--accent); }
.simple-pill.active { background:rgba(232,162,58,.15); border-color:var(--accent); color:var(--accent); }

/* CALC BREAKDOWN */
.calc-section { margin-bottom:14px; }
.calc-card { border-radius:12px; overflow:hidden; margin-bottom:8px; }
.calc-card-header { padding:10px 16px; font-size:12px; font-weight:700; letter-spacing:1px; text-transform:uppercase; }
.calc-card-header.pricing { background:#1C2A1C; color:var(--green); }
.calc-card-header.production { background:#1A2436; color:var(--blue); }
.calc-row { display:flex; justify-content:space-between; padding:9px 16px; border-bottom:1px solid var(--border); background:var(--card); }
.calc-row:last-child { border-bottom:none; }
.calc-label { color:var(--muted); font-size:13px; }
.calc-value { color:var(--text); font-size:13px; font-weight:600; }
.calc-value.highlight { color:var(--green); }
.calc-value.blue { color:var(--blue); }
.calc-alert { background:#1C2A1C; border:1px solid var(--greenborder); border-radius:10px; padding:12px 14px; margin-bottom:8px; color:var(--green); font-size:13px; line-height:1.6; }
.calc-alert.production { background:var(--bluebg); border-color:var(--blueborder); color:var(--blue); }

/* PRICE RESULT */
.price-card { background:var(--greenbg); border:1px solid var(--greenborder); border-radius:12px; padding:16px; margin-bottom:14px; text-align:center; }
.price-label { color:var(--green); font-size:11px; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; }
.price-value { color:var(--green); font-size:34px; font-weight:800; margin-top:3px; }
.price-warning { color:var(--error); font-size:12px; margin-top:5px; }

/* CUSTOMER CHIP */
.customer-chip { background:var(--subcat); border:1px solid var(--border); border-radius:12px; padding:11px 14px; margin:0 0 12px; display:flex; align-items:center; gap:11px; }
.chip-avatar { width:38px; height:38px; border-radius:19px; background:var(--accent); display:flex; align-items:center; justify-content:center; font-size:15px; font-weight:900; color:var(--bg); flex-shrink:0; }
.chip-name { color:var(--text); font-size:15px; font-weight:700; }
.chip-sub  { color:var(--muted); font-size:12px; margin-top:1px; }

/* PRODUCT LIST */
.cat-card { background:var(--card); border:1px solid var(--border); border-radius:14px; margin-bottom:11px; overflow:hidden; }
.cat-header { display:flex; align-items:center; justify-content:space-between; padding:15px 16px; cursor:pointer; user-select:none; }
.cat-left { display:flex; align-items:center; gap:12px; }
.cat-icon { font-size:22px; }
.cat-name { color:var(--text); font-size:17px; font-weight:700; }
.expand-icon { color:var(--accent); font-size:18px; font-weight:700; }
.cat-body { border-top:1px solid var(--border); }
.subcat-header { display:flex; align-items:center; justify-content:space-between; padding:11px 20px; background:var(--subcat); border-bottom:1px solid var(--border); cursor:pointer; }
.subcat-name { color:var(--text); font-size:15px; font-weight:600; }
.leaf-item { display:flex; align-items:center; justify-content:space-between; padding:12px 24px; border-bottom:1px solid var(--border); cursor:pointer; transition:background .12s; }
.leaf-item:hover  { background:rgba(232,162,58,.07); }
.leaf-item:active { background:rgba(232,162,58,.14); }
.leaf-name  { color:var(--muted); font-size:15px; }
.leaf-arrow { color:var(--accent); font-size:20px; font-weight:700; }
/* BRAND HEADER */
.brand-header { text-align:center; padding:22px 20px 10px; }
.brand-logo { max-height:90px; max-width:240px; object-fit:contain; filter:drop-shadow(0 2px 8px rgba(0,0,0,.4)); }
.brand-logo-fallback { font-size:26px; font-weight:900; color:var(--accent); letter-spacing:.5px; }
.brand-tagline { color:var(--muted); font-size:13px; margin-top:7px; letter-spacing:.3px; }
/* PRODUCT GRID TILES */
.prod-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; padding:10px 10px 14px; }
.prod-tile { background:var(--card); border:1.5px solid var(--border); border-radius:12px; cursor:pointer; overflow:hidden; transition:transform .12s,border-color .12s,background .12s; display:flex; flex-direction:column; align-items:center; }
.prod-tile:hover  { border-color:var(--accent); }
.prod-tile:active { transform:scale(.95); border-color:var(--accent); background:rgba(232,162,58,.08); }
.prod-tile-img { width:100%; aspect-ratio:1/1; background:var(--subcat); display:flex; align-items:center; justify-content:center; font-size:34px; overflow:hidden; }
.prod-tile-img img { width:100%; height:100%; object-fit:cover; }
.prod-tile-name { font-size:11px; font-weight:700; color:var(--text); text-align:center; padding:6px 4px 8px; line-height:1.3; }
/* OFFER LOGO */
.offer-logo { max-height:64px; max-width:210px; object-fit:contain; margin-bottom:6px; filter:drop-shadow(0 1px 4px rgba(0,0,0,.25)); }

/* CART */
.cart-section { padding:0 16px; margin-top:12px; flex-shrink:0; }
.cart-item-row { background:var(--card); border:1px solid var(--border); border-radius:10px; padding:10px 14px; margin-bottom:8px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
.cart-item-info { flex:1; }
.cart-item-name  { color:var(--text); font-size:14px; font-weight:600; }
.cart-item-dims  { color:var(--muted); font-size:12px; margin-top:2px; }
.cart-item-price { color:var(--green); font-size:15px; font-weight:700; white-space:nowrap; }
.cart-item-del   { background:none; border:none; color:var(--error); font-size:20px; cursor:pointer; padding:0 4px; }

.view-cart-bar { background:var(--accent); border-radius:14px; padding:15px 20px; display:flex; align-items:center; justify-content:space-between; cursor:pointer; transition:transform .15s; position:fixed; bottom:12px; left:50%; transform:translateX(-50%); width:calc(100% - 32px); max-width:568px; z-index:100; box-shadow:0 4px 24px rgba(232,162,58,.5); }
.view-cart-left  { color:var(--bg); font-size:15px; font-weight:700; }
.view-cart-total { color:var(--bg); font-size:18px; font-weight:900; }

/* PREVIEW */
.offer-header-card { background:var(--accent); border-radius:16px; padding:18px 20px; margin:10px 0 18px; text-align:center; }
.offer-company  { font-size:21px; font-weight:900; color:var(--bg); }
.offer-subtitle { font-size:12px; color:#5A3A10; margin:2px 0 10px; }
.offer-meta     { font-size:13px; font-weight:700; color:var(--bg); margin-top:2px; }
.detail-row { display:flex; justify-content:space-between; align-items:flex-start; padding:10px 16px; border-bottom:1px solid var(--border); }
.detail-row:last-child { border-bottom:none; }
.detail-label { color:var(--muted); font-size:13px; flex:1; }
.detail-value { color:var(--text); font-size:13px; text-align:right; flex:1.3; }
.detail-value.bold { font-weight:700; }
.item-card { background:var(--card); border:1px solid var(--border); border-radius:12px; margin-bottom:10px; overflow:hidden; }
.item-card-header { background:var(--subcat); padding:10px 16px; display:flex; justify-content:space-between; align-items:center; }
.item-card-name  { color:var(--text); font-size:14px; font-weight:700; }
.item-card-price { color:var(--green); font-size:15px; font-weight:800; }
.production-card { background:var(--bluebg); border:1px solid var(--blueborder); border-radius:12px; margin-bottom:10px; overflow:hidden; }
.production-header { background:#1E3050; padding:10px 16px; }
.production-title { color:var(--blue); font-size:12px; font-weight:700; letter-spacing:1px; text-transform:uppercase; }
.total-row { display:flex; justify-content:space-between; align-items:center; padding:15px 16px; background:var(--greenbg); }
.total-label { color:var(--green); font-size:15px; font-weight:800; }
.total-value { color:var(--green); font-size:22px; font-weight:900; }
.signature-box { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px 20px; display:flex; flex-direction:column; align-items:flex-end; margin-bottom:14px; }
.sig-label { color:var(--muted); font-size:12px; margin-bottom:10px; }
.sig-placeholder { width:140px; height:65px; border:1px dashed var(--border); border-radius:8px; }

/* PRODUCT FORM */
.product-banner { background:var(--accent); border-radius:14px; padding:16px 20px; margin:10px 0 16px; }
.product-cat-label { color:#7A5010; font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1px; }
.product-title { color:var(--bg); font-size:22px; font-weight:800; margin-top:3px; }
.qty-row { display:flex; align-items:center; justify-content:center; padding:12px; gap:24px; }
.qty-btn { width:44px; height:44px; border-radius:22px; background:var(--border); border:none; cursor:pointer; color:var(--accent); font-size:24px; font-weight:700; display:flex; align-items:center; justify-content:center; }
.qty-btn:hover { background:#2d4560; }
.qty-value { color:var(--text); font-size:22px; font-weight:700; min-width:40px; text-align:center; }

/* BUTTONS */
.btn-primary   { width:100%; background:var(--accent); border:none; border-radius:12px; padding:17px; color:var(--bg); font-size:16px; font-weight:800; cursor:pointer; margin-bottom:11px; font-family:inherit; transition:opacity .15s; }
.btn-primary:hover { opacity:.9; }
.btn-primary:disabled { opacity:.5; cursor:default; }
.btn-secondary { width:100%; background:var(--border); border:none; border-radius:12px; padding:15px; color:var(--accent); font-size:16px; font-weight:700; cursor:pointer; margin-bottom:11px; font-family:inherit; }
.btn-ghost     { width:100%; background:var(--border); border:none; border-radius:12px; padding:15px; color:var(--text); font-size:15px; font-weight:700; cursor:pointer; margin-bottom:11px; font-family:inherit; }
.btn-outline   { width:100%; background:none; border:1.5px solid var(--accent); border-radius:12px; padding:15px; color:var(--accent); font-size:15px; font-weight:700; cursor:pointer; margin-bottom:11px; font-family:inherit; }
.sent-banner   { background:var(--greenbg); border:1px solid var(--greenborder); border-radius:14px; padding:17px; text-align:center; color:var(--green); font-size:17px; font-weight:700; margin-bottom:11px; }
.spacer { height:36px; }
/* LOADING */
.loading-screen { position:fixed; inset:0; background:var(--bg); z-index:999; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:16px; }
.spinner { width:44px; height:44px; border:3px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin .8s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }
.load-err { background:#2A1A1A; border:1px solid var(--error); border-radius:12px; padding:16px 20px; color:var(--error); font-size:14px; text-align:center; max-width:320px; }
</style>
</head>
<body>
<div id="loading-screen" class="loading-screen">
  <div class="spinner"></div>
  <div style="color:var(--muted);font-size:14px">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î¹Î¼Î¿ÎºÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï…...</div>
</div>

<div class="phone-shell">

  <!-- â•â•â•â•â•â• SCREEN 1: Î Î•Î›Î‘Î¤Î—Î£ â•â•â•â•â•â• -->
  <div class="screen" id="screen-customer">
    <div class="screen-header">
      <span class="screen-title">ÎÎ­Î± Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬</span>
      <button class="back-btn" style="color:var(--muted);font-size:13px" onclick="newOffer()">ğŸ—‘ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
    </div>
    <div class="scroll-area">
      <div class="brand-header">
        <img src="https://lh3.googleusercontent.com/d/0BzVeEhCT7VKDSDBUeTJnRXdZRlk" alt="Tsoukalas &amp; Co" class="brand-logo" onerror="this.style.display='none';this.nextElementSibling.style.display='block'">
        <div class="brand-logo-fallback" style="display:none">Tsoukalas &amp; Co</div>
        <div class="brand-tagline">Î¤Î­Î½Ï„ÎµÏ‚ &middot; Î Î­ÏÎ³ÎºÎ¿Î»ÎµÏ‚ &middot; Î¤Î¶Î¬Î¼Î¹Î±</div>
      </div>
      <div class="section-label">Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î ÎµÎ»Î¬Ï„Î·</div>
      <div class="info-card">
        <div class="field-row"><label class="field-label">ÎŒÎ½Î¿Î¼Î± <span style="color:var(--accent)">*</span></label><input class="field-input" id="c-first" placeholder="Î“Î¹ÏÏÎ³Î·Ï‚"></div>
        <div class="field-row"><label class="field-label">Î•Ï€ÏÎ½Ï…Î¼Î¿ <span style="color:var(--accent)">*</span></label><input class="field-input" id="c-last" placeholder="Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚"></div>
        <div class="field-row"><label class="field-label">Î•Ï„Î±Î¹ÏÎµÎ¯Î±</label><input class="field-input" id="c-company" placeholder="Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ"></div>
        <div class="field-row"><label class="field-label">Email</label><input class="field-input" id="c-email" placeholder="email@example.com" type="email"></div>
        <div class="field-row"><label class="field-label">ÎšÎ¹Î½Î·Ï„ÏŒ</label><input class="field-input" id="c-mobile" placeholder="69X XXXXXXX" type="tel"></div>
        <div class="field-row"><label class="field-label">Î¤Î·Î»Î­Ï†Ï‰Î½Î¿</label><input class="field-input" id="c-phone" placeholder="21X XXXXXXX" type="tel"></div>
        <div class="field-row"><label class="field-label">Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</label><input class="field-input" id="c-address" placeholder="Î¿Î´ÏŒÏ‚, Î±ÏÎ¹Î¸Î¼ÏŒÏ‚"></div>
        <div class="field-row"><label class="field-label">Î ÏŒÎ»Î·</label><input class="field-input" id="c-city" placeholder="Î‘Î¸Î®Î½Î±"></div>
        <div class="field-row"><label class="field-label">Î‘Î¦Îœ</label><input class="field-input" id="c-afm" placeholder="Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ"></div>
      </div>
      <div class="section-label">Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</div>
      <div class="info-card">
        <div class="field-row" style="padding:0"><textarea class="field-input" id="c-notes" rows="3" placeholder="Î™ÏƒÏ‡ÏÏ‚, Ï€Î±ÏÎ¬Î´Î¿ÏƒÎ·, ÏŒÏÎ¿Î¹ Ï€Î»Î·ÏÏ‰Î¼Î®Ï‚..."></textarea></div>
      </div>
      <button class="btn-primary" onclick="goToProducts()">Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± â†’ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½</button>
      <div class="spacer"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â• SCREEN 2: Î›Î™Î£Î¤Î‘ Î Î¡ÎŸÎªÎŸÎÎ¤Î©Î â•â•â•â•â•â• -->
  <div class="screen" id="screen-home">
    <div class="screen-header">
      <button class="back-btn" onclick="goTo('customer')">â€¹ Î Î¯ÏƒÏ‰</button>
      <span class="screen-title">Î ÏÎ¿ÏŠÏŒÎ½Ï„Î±</span>
      <div></div>
    </div>
    <div class="scroll-area">
      <div class="customer-chip">
        <div class="chip-avatar" id="chip-avatar">Î“Î </div>
        <div><div class="chip-name" id="chip-name">â€”</div><div class="chip-sub" id="chip-sub">â€”</div></div>
      </div>
      <div class="cart-section" id="cart-section" style="display:none">
        <div class="section-label" style="padding:0 0 0 2px">Î£Ï„Î·Î½ Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬</div>
        <div id="cart-items-list"></div>
      </div>
      <div class="section-label">+ Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚</div>
      <div id="productList"></div>
      <div class="spacer"></div>
    </div>
    <div class="view-cart-bar" id="view-cart-bar" style="display:none" onclick="goToPreview()">
      <span class="view-cart-left">ğŸ“„ Î”ÎµÏ‚ Ï„Î·Î½ Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬</span>
      <span class="view-cart-total" id="cart-total-display">0.00 â‚¬</span>
    </div>
  </div>

  <!-- â•â•â•â•â•â• SCREEN 3: Î¦ÎŸÎ¡ÎœÎ‘ Î Î¡ÎŸÎªÎŸÎÎ¤ÎŸÎ£ â•â•â•â•â•â• -->
  <div class="screen" id="screen-product">
    <div class="screen-header">
      <button class="back-btn" onclick="goTo('home')">â€¹ Î Î¯ÏƒÏ‰</button>
      <div></div>
    </div>
    <div class="scroll-area">
      <div class="product-banner">
        <div class="product-cat-label" id="pf-category"></div>
        <div class="product-title" id="pf-name"></div>
      </div>
      <div class="section-label">Î”Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚</div>
      <div class="info-card" id="pf-fields"></div>
      <div id="antirides-section" style="display:none">
        <div class="section-label" id="label-mechanism">ÎœÎ·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚</div>
        <div id="dd-mechanism"></div>
        <div class="section-label">Î†Î¾Î¿Î½Î±Ï‚</div>
        <div id="dd-axonas"></div>
        <div id="seta-question" style="display:none">
          <div class="seta-question">
            <div class="seta-q-title">âš ï¸ Î¤Î­Î½Ï„Î± > 500cm â€” Î ÏŒÏƒÎ± ÏƒÎµÏ„ Î±Î½Ï„Î¹ÏÎ¯Î´Î±Ï‚;</div>
            <div class="seta-options" id="seta-options"></div>
          </div>
        </div>
        <div class="section-label">Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬</div>
        <div class="info-card">
          <div class="toggle-row" id="toggle-entatiras">
            <div>
              <div class="toggle-label">Î•Î½Ï„Î±Ï„Î®ÏÎ±Ï‚</div>
              <div class="toggle-sub" style="color:var(--muted);font-size:12px">Î‘Î½Ï„Î¹ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ &amp; ÎºÎ¿Ï…Î¶Î¹Î½Î­Ï„Î¿</div>
            </div>
            <div class="toggle-switch" id="sw-entatiras" onclick="toggleEntatiras()"><div class="toggle-knob"></div></div>
          </div>
          <div class="toggle-row">
            <div>
              <div class="toggle-label">ÎœÎ¿Ï„Î­Ï Î¼Îµ Î‘Î½Ï„Î¯Î»Î·ÏˆÎ· Î•Î¼Ï€Î¿Î´Î¯Î¿Ï…</div>
              <div class="toggle-sub" style="color:var(--muted);font-size:12px">Î‘Î½Ï„Î¹ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ, ÎµÎ½Ï„Î±Ï„Î®ÏÎ± &amp; Î¼Î±Î½Î¹Î²Î­Î»Î±</div>
            </div>
            <div class="toggle-switch" id="sw-motor" onclick="toggleMotor()"><div class="toggle-knob"></div></div>
          </div>
          <div class="toggle-row">
            <div class="toggle-label">Î§Î¿ÏÏ†Ï„Î± Î‘Î»Î¿Ï…Î¼Î¹Î½Î¯Î¿Ï…</div>
            <input type="number" id="qty-xoufta" class="field-input" style="width:60px;text-align:center;display:none" value="1" min="1" max="10">
            <div class="toggle-switch" id="sw-xoufta" onclick="toggleSwitch('sw-xoufta')"><div class="toggle-knob"></div></div>
          </div>
          <div class="toggle-row">
            <div class="toggle-label">Î§Î¿ÏÏ†Ï„Î± Î™Î¼Î¬Î½Ï„Î±Ï‚</div>
            <input type="number" id="qty-xoufta-imanta" class="field-input" style="width:60px;text-align:center;display:none" value="1" min="1" max="10">
            <div class="toggle-switch" id="sw-xoufta-imanta" onclick="toggleSwitch('sw-xoufta-imanta')"><div class="toggle-knob"></div></div>
          </div>
        </div>
        <div id="manivela-section">
          <div class="section-label">ÎœÎ±Î½Î¹Î²Î­Î»Î±</div>
          <div id="dd-manivela"></div>
        </div>
        <div id="xeiristirio-section" style="display:none">
          <div class="section-label">Î§ÎµÎ¹ÏÎ¹ÏƒÏ„Î®ÏÎ¹Î¿</div>
          <div class="info-card">
            <div class="field-row">
              <span class="field-label">Î¤ÏÏ€Î¿Ï‚</span>
              <input class="field-input" id="pf-xeiristirio" placeholder="Ï€.Ï‡. Radio, Timer...">
            </div>
          </div>
        </div>
        <div class="section-label">ÎÏ†Î±ÏƒÎ¼Î±</div>
        <div id="dd-fabric-antirides"></div>
        <div class="section-label">Î•Ï€Î¹Î»Î¿Î³Î­Ï‚ Î¥Ï†Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚</div>
        <div class="info-card" style="display:flex;gap:8px;flex-wrap:wrap;padding:10px">
          <div style="flex:1;min-width:100px">
            <div style="color:var(--muted);font-size:11px;margin-bottom:5px">Î˜Î®ÎºÎ·</div>
            <div id="sl-thiki" class="simple-list"></div>
          </div>
          <div style="flex:1;min-width:100px">
            <div style="color:var(--muted);font-size:11px;margin-bottom:5px">Î“Î»ÏÏƒÏƒÎ±</div>
            <div id="sl-glossa" class="simple-list"></div>
          </div>
          <div style="flex:1;min-width:100px">
            <div style="color:var(--muted);font-size:11px;margin-bottom:5px">Î¤ÏÏ€Î¿Ï‚ Î“Î»ÏÏƒÏƒÎ±Ï‚</div>
            <div id="sl-typosGlossis" class="simple-list"></div>
          </div>
        </div>
      </div>
      <div id="yfasma-section" style="display:none">
        <div class="section-label">Î•Ï€Î¹Î»Î¿Î³Î® Î Î±Î½Î¹Î¿Ï</div>
        <div id="dd-fabric-yfasma"></div>
      </div>
      <div class="section-label">Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</div>
      <div class="info-card">
        <div class="field-row" style="padding:0"><textarea class="field-input" id="pf-notes" rows="2" placeholder="Î•Î¹Î´Î¹ÎºÎ­Ï‚ Î±Ï€Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚..."></textarea></div>
      </div>
      <div id="price-result" style="display:none">
        <div class="section-label">Î‘Î½Î¬Î»Ï…ÏƒÎ· Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚</div>
        <div class="calc-card">
          <div class="calc-card-header pricing">ğŸ’° ÎšÏŒÏƒÏ„Î¿Ï‚</div>
          <div id="pricing-breakdown"></div>
        </div>
        <div class="price-card">
          <div class="price-label">Î¤ÎµÎ»Î¹ÎºÎ® Î¤Î¹Î¼Î® (Ï‡Ï‰ÏÎ¯Ï‚ Î¦Î Î‘)</div>
          <div class="price-value" id="price-display">0.00 â‚¬</div>
          <div class="price-warning" id="price-warning" style="display:none">âš ï¸ Î•Ï†Î±ÏÎ¼ÏŒÏƒÏ„Î·ÎºÎµ ÎµÎ»Î¬Ï‡Î¹ÏƒÏ„Î· Ï‡ÏÎ­Ï‰ÏƒÎ· 60â‚¬</div>
        </div>
        <div id="production-section" style="display:none">
          <div class="section-label">ğŸ­ Î”ÎµÎ»Ï„Î¯Î¿ Î Î±ÏÎ±Î³Ï‰Î³Î®Ï‚</div>
          <div class="calc-card">
            <div class="calc-card-header production">Î£Î¹Î´Î·ÏÎ¿ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î®</div>
            <div id="production-iron"></div>
          </div>
          <div class="calc-card">
            <div class="calc-card-header production">ÎÏ†Î±ÏƒÎ¼Î±</div>
            <div id="production-fabric"></div>
          </div>
          <div id="production-alerts"></div>
        </div>
      </div>
      <button class="btn-secondary" onclick="calcPrice()">Î¥Ï€Î¿Î»ÏŒÎ³Î¹ÏƒÎµ Î¤Î¹Î¼Î®</button>
      <button class="btn-primary" onclick="addToOffer()">âœš Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î·Î½ Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬</button>
      <button class="btn-outline" id="add-another-btn" style="display:none" onclick="addAndPickAnother()">âœš Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ &amp; Î•Ï€Î¹Î»Î¿Î³Î® Î†Î»Î»Î¿Ï…</button>
      <div class="spacer"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â• SCREEN 4: Î Î¡ÎŸÎ•Î Î™Î£ÎšÎŸÎ Î—Î£Î— â•â•â•â•â•â• -->
  <div class="screen" id="screen-preview">
    <div class="screen-header">
      <button class="back-btn" onclick="goTo('home')">â€¹ Î Î¯ÏƒÏ‰</button>
      <span class="screen-title" style="font-size:18px">Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬</span>
      <div style="width:50px"></div>
    </div>
    <div class="scroll-area">
      <div class="offer-header-card">
        <img src="https://lh3.googleusercontent.com/d/0BzVeEhCT7VKDSDBUeTJnRXdZRlk" alt="Tsoukalas &amp; Co" class="offer-logo" onerror="this.style.display='none';this.nextElementSibling.style.display='block'">
        <div class="offer-company" style="display:none">Tsoukalas &amp; Co</div>
        <div class="offer-subtitle">Î¤Î­Î½Ï„ÎµÏ‚ Â· Î Î­ÏÎ³ÎºÎ¿Î»ÎµÏ‚ Â· Î¤Î¶Î¬Î¼Î¹Î±</div>
        <div class="offer-meta" id="prev-offernum"></div>
        <div class="offer-meta" id="prev-date"></div>
      </div>
      <div class="section-label">Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î ÎµÎ»Î¬Ï„Î·</div>
      <div class="info-card" id="prev-customer"></div>
      <div class="section-label">Î ÏÎ¿ÏŠÏŒÎ½Ï„Î±</div>
      <div id="prev-items"></div>
      <div class="section-label">Î£ÏÎ½Î¿Î»Î¿</div>
      <div class="info-card">
        <div class="detail-row"><span class="detail-label">ÎšÎ±Î¸Î±ÏÎ® Î‘Î¾Î¯Î±</span><span class="detail-value" id="prev-net"></span></div>
        <div class="detail-row"><span class="detail-label">Î¦Î Î‘ 24%</span><span class="detail-value" id="prev-vat"></span></div>
        <div class="total-row"><span class="total-label">Î£Î¥ÎÎŸÎ›ÎŸ</span><span class="total-value" id="prev-total"></span></div>
      </div>
      <div id="prev-notes-section" style="display:none">
        <div class="section-label">Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</div>
        <div class="info-card"><div style="padding:14px;color:var(--text);font-size:14px;line-height:1.6" id="prev-notes"></div></div>
      </div>
      <div class="signature-box">
        <div class="sig-label">Î£Ï†ÏÎ±Î³Î¯Î´Î± / Î¥Ï€Î¿Î³ÏÎ±Ï†Î®</div>
        <div class="sig-placeholder"></div>
      </div>
      <div id="sent-banner" style="display:none" class="sent-banner">âœ… Î— Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ¬ ÎµÏƒÏ„Î¬Î»Î·!</div>
      <button class="btn-primary" id="send-btn" onclick="sendToCustomer()">ğŸ“§ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ÏƒÏ„Î¿Î½ Î ÎµÎ»Î¬Ï„Î·</button>
      <button class="btn-primary" id="prod-btn" style="background:var(--greenbg);border:1px solid var(--greenborder);color:var(--green);margin-top:8px" onclick="sendToProduction()">ğŸ­ Email Î Î±ÏÎ±Î³Ï‰Î³Î®Ï‚</button>
      <button class="btn-outline" onclick="goTo('home')">âœš Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î‘ÎºÏŒÎ¼Î± Î ÏÎ¿ÏŠÏŒÎ½Ï„Î¿Ï‚</button>
      <button class="btn-ghost" onclick="newOffer()">+ ÎÎ­Î± Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬</button>
      <div class="spacer"></div>
    </div>
  </div>
</div>

<script>
const SHEET_ID   = '1_UOqGssz9277aDqdzezku0mElAun5p5JNco4JfhWfk8';
const SHEET_NAME = 'Antirides';
const BUSINESS_EMAIL = 'orders@tsoukalasco.com';
const BUSINESS_NAME  = 'Tsoukalas & Co';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Î’Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ â€” Î±ÎºÏÎ¹Î²Î®Ï‚ Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î® Î±Ï€ÏŒ Sheet
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STATIC_DB = {
  fabrics: [
    { id:'TenCateEcru',      name:'Ten Cate Î•ÎºÏÎ¿Ï',     pricePerSqm:19, width:160.4 },
    { id:'TenCateColor',     name:'Ten Cate Î•Î¼Ï€ÏÎ¹Î¼Î­',   pricePerSqm:22, width:160   },
    { id:'CalbariEcru',      name:'Calbari Ecru',        pricePerSqm:18, width:160   },
    { id:'CalbariColor',     name:'Calbari Î•Î¼Ï€ÏÎ¹Î¼Î­',    pricePerSqm:21, width:150   },
    { id:'Offer',            name:'Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚',           pricePerSqm:16, width:160   },
    { id:'Transparent',      name:'Î–ÎµÎ»Î±Ï„Î¯Î½Î±',            pricePerSqm:20, width:150   },
    { id:'ParaSattler',      name:'Para/Sattler',        pricePerSqm:23, width:120   },
    { id:'SattlerLumera',    name:'Sattler Lumera',      pricePerSqm:25, width:120   },
    { id:'ParaSattlerMAX',   name:'Para/Sattler MAX',    pricePerSqm:30, width:120   },
  ],
  mechanisms: [
    { id:'4r',                  name:'ÎšÎ±ÏÎ­ 4 Î¡Î¿Ï…Î»ÎµÎ¼Î¬Î½',        price:30, width:9.5, strifonia:2 },
    { id:'Markiza',             name:'ÎœÎ±ÏÎºÎ¯Î¶Î±Ï‚',                price:20, width:10,  strifonia:2 },
    { id:'Lamaki',              name:'Î›Î±Î¼Î¬ÎºÎ¹',                  price:20, width:10,  strifonia:2 },
    { id:'Stenoskodithileia',   name:'Î£Ï„ÎµÎ½ÏŒÏ‚ ÎšÎ¿Î½Ï„Î® Î˜Î·Î»ÎµÎ¹Î¬',     price:20, width:6,   strifonia:2 },
    { id:'Stenosmakriathileia', name:'Î£Ï„ÎµÎ½ÏŒÏ‚ ÎœÎ±ÎºÏÎ¹Î¬ Î˜Î·Î»ÎµÎ¹Î¬',    price:20, width:6,   strifonia:2 },
  ],
  axones: [
    { id:'F48', name:'Î¦48', pricePerM:7  },
    { id:'F60', name:'Î¦60', pricePerM:8  },
    { id:'F70', name:'Î¦70', pricePerM:11 },
    { id:'F78', name:'Î¦78', pricePerM:15 },
    { id:'F85', name:'Î¦85', pricePerM:18 },
  ],
  entatiras:   { id:'Entatiras', name:'Î•Î½Ï„Î±Ï„Î®ÏÎ±Ï‚',           price:65,  width:28, strifonia:10 },
  motor:       { name:'ÎœÎ¿Ï„Î­Ï ÎœÎµ Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·ÏƒÎ·',               price:300, width:6,  strifonia:2  },
  antivaro:    { name:'Î¦33',  pricePerM:5 },
  kouzineto:   { price:7, qty:1, strifonia:2 },
  setAntiridas:{ price:11, strifonia:1 },
  kolonaki:    { price:6 },
  solinaAloum: { pricePerM:7 },
  maniveles:   [
    { id:'Kanoniki', name:'ÎšÎ±Î½Î¿Î½Î¹ÎºÎ®', price:15 },
    { id:'Kodi',     name:'ÎšÎ¿Î½Ï„Î®',    price:10 },
  ],
  xouftes: [
    { id:'XouftaAlouminiou', name:'Î§Î¿ÏÏ†Ï„Î± Î‘Î»Î¿Ï…Î¼Î¹Î½Î¯Î¿Ï…', price:20, qty:1, strifonia:2 },
    { id:'XouftaImanta',     name:'Î§Î¿ÏÏ†Ï„Î± Î™Î¼Î¬Î½Ï„Î±Ï‚',    price:50, qty:1, strifonia:2 },
  ],
  strifonia:   { price:1 },
  oupa:        { price:1 },
  tapes:       { price:1 },
  minCharge:   60,
  thiki:        [{ id:'Î¡Î¬Î¿Ï…Î»Î¿', name:'Î¡Î¬Î¿Ï…Î»Î¿' }, { id:'Î‘Ï€Î»Î®', name:'Î‘Ï€Î»Î®' }, { id:'Î¡Î¹Î½Ï„ÏŒ', name:'Î¡Î¹Î½Ï„ÏŒ' }],
  glossa:       [{ id:'30Î¬ÏÎ±',  name:'30Î¬ÏÎ±'  }, { id:'25Î¬ÏÎ±', name:'25Î¬ÏÎ±' }],
  typosGlossis: [{ id:'ÎšÏÎ¼Î±',   name:'ÎšÏÎ¼Î±'   }, { id:'ÎŠÏƒÎ¹Î±',  name:'ÎŠÏƒÎ¹Î±'  }],
};

// DB = Ï€Î¬Î½Ï„Î± deep copy Ï„Î·Ï‚ STATIC_DB â€” Ï€Î¿Ï„Î­ reference bugs
let DB = JSON.parse(JSON.stringify(STATIC_DB));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î¹Î¼ÏÎ½ Î±Ï€ÏŒ Google Sheet (background)
// Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ gviz JSON API â€” Ï€Î¹Î¿ Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î¿ Î±Ï€ÏŒ CSV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gvizVal(cell) {
  if (!cell) return null;
  return cell.v !== undefined ? cell.v : null;
}

async function syncFromSheet() {
  try {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;
    const ctrl = new AbortController();
    const t = setTimeout(() => ctrl.abort(), 8000);
    const resp = await fetch(url, { signal: ctrl.signal });
    clearTimeout(t);
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    const text = await resp.text();
    // gviz response Î¾ÎµÎºÎ¹Î½Î¬ Î¼Îµ "/*O_o*/\ngoogle.visualization.Query.setResponse("
    const json = JSON.parse(text.replace(/^[^{]*/, '').replace(/\);?\s*$/, ''));
    const rows = json.table.rows;
    const cell = (row, col) => {
      const c = row.c && row.c[col];
      return c ? (c.v !== null && c.v !== undefined ? String(c.v).trim() : '') : '';
    };
    const num = (row, col) => parseFloat(cell(row, col)) || 0;

    // ÎÎ­Î· DB Î±Ï€ÏŒ sheet
    const sdb = JSON.parse(JSON.stringify(STATIC_DB)); // Î¾ÎµÎºÎ¹Î½Î¬Î¼Îµ Î±Ï€ÏŒ static
    let section = null;

    for (const row of rows) {
      const c0 = cell(row, 0);
      const c1 = cell(row, 1);
      const c2 = num(row, 2);   // price/pricePerSqm/pricePerM
      const c3 = num(row, 3);   // width
      const c4 = num(row, 4);   // strifonia / qty

      // Section headers
      if (c0 === 'Fabrics')      { section = 'fabrics';      sdb.fabrics = [];      continue; }
      if (c0 === 'Mechanism')    { section = 'mechanism';    sdb.mechanisms = [];   continue; }
      if (c0 === 'Kouzineta')    { section = 'kouzineta';    continue; }
      if (c0 === 'Axonas')       { section = 'axonas';       sdb.axones = [];       continue; }
      if (c0 === 'Antivaro')     { section = 'antivaro';     continue; }
      if (c0 === 'Antirides')    { section = 'antirides';    continue; }
      if (c0 === 'Maniveles')    { section = 'maniveles';    sdb.maniveles = [];    continue; }
      if (c0 === 'Xouftes')      { section = 'xouftes';      sdb.xouftes = [];      continue; }
      if (c0 === 'Thiki')        { section = 'thiki';        sdb.thiki = [];        continue; }
      if (c0 === 'Glossa')       { section = 'glossa';       sdb.glossa = [];       continue; }
      if (c0 === 'TiposGlossas') { section = 'typosGlossis'; sdb.typosGlossis = []; continue; }
      if (!c0 && !c2) continue;

      switch (section) {
        case 'fabrics':
          if (c2) sdb.fabrics.push({ id: c0, name: c1 || c0, pricePerSqm: c2, width: c3 || 160 });
          break;
        case 'mechanism':
          if (c0 === 'Entatiras') {
            // width Î±Ï€ÏŒ STATIC_DB â€” Ï„Î¿ sheet Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ format Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±Ï‚ ÏƒÏ„Î¿ ÎºÎµÎ»Î¯
            const staticEnt = STATIC_DB.entatiras;
            sdb.entatiras = { id:'Entatiras', name: c1||staticEnt.name, price: c2||staticEnt.price, width: staticEnt.width, strifonia: c4||staticEnt.strifonia };
          } else if (c0 === 'Motor') {
            const staticMot = STATIC_DB.motor;
            sdb.motor = { name: c1||staticMot.name, price: c2||staticMot.price, width: staticMot.width, strifonia: c4||staticMot.strifonia };
          } else if (c2) {
            // Î’ÏÎµÏ‚ Ï„Î¿ Î±Î½Ï„Î¯ÏƒÏ„Î¿Î¹Ï‡Î¿ Î±Ï€ÏŒ STATIC_DB Î³Î¹Î± Ï„Î¿ width
            const staticMech = STATIC_DB.mechanisms.find(m => m.id === c0);
            sdb.mechanisms.push({ id: c0, name: c1||c0, price: c2, width: staticMech?.width ?? c3, strifonia: c4 });
          }
          break;
        case 'kouzineta':
          if (c0 === 'Kouzineto' && c2) sdb.kouzineto = { price: c2, qty: 1, strifonia: c4 };
          break;
        case 'axonas':
          if (c2) sdb.axones.push({ id: c0, name: c1 || c0, pricePerM: c2 });
          break;
        case 'antivaro':
          if (c2) sdb.antivaro = { name: c1 || c0, pricePerM: c2 };
          break;
        case 'antirides':
          if (c0 === 'AlluminumPipe' && c2) sdb.solinaAloum = { pricePerM: c2 };
          else if (c0.startsWith('SetAntiridas') && c2) sdb.setAntiridas = { price: c2, strifonia: c4 };
          else if (c0 === 'Kolonaki' && c2) sdb.kolonaki = { price: c2 };
          break;
        case 'maniveles':
          if (c2) sdb.maniveles.push({ id: c0, name: c1 || c0, price: c2 });
          break;
        case 'xouftes':
          if (c2) sdb.xouftes.push({ id: c0, name: c1 || c0, price: c2, qty: 1, strifonia: c4 });
          break;
        case 'thiki':
          if (c0) sdb.thiki.push({ id: c0, name: c1 || c0 });
          break;
        case 'glossa':
          if (c0) sdb.glossa.push({ id: c0, name: c1 || c0 });
          break;
        case 'typosGlossis':
          if (c0) sdb.typosGlossis.push({ id: c0, name: c1 || c0 });
          break;
      }
      if (c0 === 'Strifonia' && c2) sdb.strifonia = { price: c2 };
      if (c0 === 'Oupa'      && c2) sdb.oupa      = { price: c2 };
      if (c0 === 'Tapes'     && c2) sdb.tapes     = { price: c2 };
    }

    DB = sdb;
    // Î‘Î½Î±Î½Î­Ï‰ÏƒÎ· dropdowns Î±Î½ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ Î®Î´Î· ÏƒÏ„Î· Ï†ÏŒÏÎ¼Î±
    if (currentProduct) selectProduct(currentProduct, currentCategory);
    console.log('âœ… DB ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ Î±Ï€ÏŒ Google Sheet');
  } catch (e) {
    console.warn('âš ï¸ Sheet sync Î±Ï€Î­Ï„Ï…Ï‡Îµ, Ï‡ÏÎ®ÏƒÎ· static DB:', e.message);
  }
}

function loadDB() {
  // Î†Î¼ÎµÏƒÎ· ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· Î¼Îµ static DB â€” Î¼Î·Î´ÎµÎ½Î¹ÎºÎ® ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ·
  DB = JSON.parse(JSON.stringify(STATIC_DB));
  document.getElementById('loading-screen').style.display = 'none';
  buildProductList();
  const hadData = restoreState();
  if (hadData && cart.length > 0) {
    const first = (document.getElementById('c-first').value || '').trim();
    const last  = (document.getElementById('c-last').value  || '').trim();
    if (first || last) {
      document.getElementById('chip-avatar').textContent = ((first[0]||'') + (last[0]||'')).toUpperCase();
      document.getElementById('chip-name').textContent   = (first + ' ' + last).trim();
      const co = document.getElementById('c-company').value.trim();
      const em = document.getElementById('c-email').value.trim();
      const mo = document.getElementById('c-mobile').value.trim();
      document.getElementById('chip-sub').textContent = co || em || mo || 'â€”';
    }
    renderCart();
    goTo('home');
  } else {
    goTo('customer');
  }
  // Sync Ï„Î¹Î¼ÏÎ½ Î±Ï€ÏŒ Sheet ÏƒÏ„Î¿ background
  syncFromSheet();
}

const PRODUCTS = [
  { id:'tenta', name:'Î¤Î­Î½Ï„Î±', icon:'â›±ï¸', subs:[
    { id:'tenta_yfasma',    name:'Î‘Î»Î»Î±Î³Î® Î¥Ï†Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚',  dims:['width','projection'] },
    { id:'tenta_antirides', name:'Î‘Î½Ï„Î¹ÏÎ¯Î´ÎµÏ‚',          dims:['width','projection'] },
    { id:'tenta_katheto',   name:'ÎšÎ¬Î¸ÎµÏ„Î¿',             dims:['width','height'] },
    { id:'tenta_kapotina',  name:'ÎšÎ±Ï€Î¿Ï„Î¯Î½Î±',           dims:['width','projection'] },
    { id:'tenta_vega',      name:'Vega',               dims:['width','projection'] },
    { id:'tenta_kaseta',    name:'ÎšÎ±ÏƒÎ­Ï„Î±',             dims:['width','projection'] },
  ]},
  { id:'pergola', name:'Î Î­ÏÎ³ÎºÎ¿Î»Î±', icon:'ğŸ›ï¸', subs:[
    { id:'p_pro100',   name:'Pro 100',            dims:['width','depth'] },
    { id:'p_pro150',   name:'Pro 150',            dims:['width','depth'] },
    { id:'p_promega',  name:'Pro Mega',           dims:['width','depth'] },
    { id:'p_kremasti', name:'ÎšÏÎµÎ¼Î±ÏƒÏ„Î®',            dims:['width','depth'] },
    { id:'p_curved',   name:'Curved',             dims:['width','depth'] },
    { id:'p_prostand', name:'Pro Standard/Plus',  dims:['width','depth'] },
    { id:'p_flat',     name:'Flat',               dims:['width','depth'] },
    { id:'p_biokl',    name:'Î’Î¹Î¿ÎºÎ»Î¹Î¼Î±Ï„Î¹ÎºÎ®',        dims:['width','depth'] },
    { id:'p_opensky',  name:'Open Sky',           dims:['width','depth'] },
    { id:'p_openroof', name:'Open Roof',          dims:['width','depth'] },
    { id:'p_stath',    name:'Î£Ï„Î±Î¸ÎµÏÎ­Ï‚ Î ÎµÏÏƒÎ¯Î´ÎµÏ‚',   dims:['width','depth'] },
    { id:'p_danai',    name:'Î”Î±Î½Î¬Î·',               dims:['width','depth'] },
    { id:'p_balloon',  name:'Balloon',            dims:['width','depth'] },
  ]},
  { id:'katheto', name:'ÎšÎ¬Î¸ÎµÏ„Î¿ Î£ÏÏƒÏ„Î·Î¼Î±', icon:'ğŸªŸ', subs:[
    { id:'ks_zip',  name:'Zip',                   dims:['width','height'] },
    { id:'ks_bt',   name:'Î’Î¤',                    dims:['width','height'] },
    { id:'ks_syrm', name:'ÎšÎ¬Î¸ÎµÏ„Î¿ Î£Ï…ÏÎ¼Î±Ï„ÏŒÏƒÏ‡Î¿Î¹Î½Î±',  dims:['width','height'] },
    { id:'ks_ntiz', name:'ÎšÎ¬Î¸ÎµÏ„Î¿ ÎÏ„Î¯Î¶ÎµÏ‚ Î¦10',     dims:['width','height'] },
  ]},
  { id:'tzamia', name:'Î¤Î¶Î¬Î¼Î¹Î±', icon:'ğŸ”·', subs:[
    { id:'tz_anemo', name:'Î‘Î½ÎµÎ¼Î¿Ï†ÏÎ¬ÎºÏ„Î·Ï‚',    dims:['width','height'] },
    { id:'tz_syro',  name:'Î£Ï…ÏÏŒÎ¼ÎµÎ½Î± Î¤Î¶Î¬Î¼Î¹Î±', dims:['width','height'] },
    { id:'tz_gil',   name:'Î“ÎºÎ¹Î»Î¿Ï„Î¯Î½Î±',       dims:['width','height'] },
  ]},
];

const DIM_LABELS  = { width:'Î Î»Î¬Ï„Î¿Ï‚ (cm)', projection:'Î ÏÎ¿Î²Î¿Î»Î® (cm)', height:'ÎÏˆÎ¿Ï‚ (cm)', depth:'Î’Î¬Î¸Î¿Ï‚ (cm)' };
const DIM_PHOLDER = { width:'Ï€.Ï‡. 300', projection:'Ï€.Ï‡. 250', height:'Ï€.Ï‡. 220', depth:'Ï€.Ï‡. 350' };
const VAT = 0.24;
let offerCounter = 1;
let cart = [], currentProduct = null, currentCategory = null;
let currentQty = 1, priceCalculated = false, currentOfferNum = null;
let sel = { mechanism:null, axonas:null, fabric:null, manivela:null, thiki:null, glossa:null, typosGlossis:null };
let opt = { entatiras:false, motor:false, xoufta:false, xouftaImanta:false };
let setaCount = 2;
let lastCalcResult = null;

function goTo(name) {
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen-'+name).classList.add('active');
  window.scrollTo(0,0);
}

function goToProducts() {
  const first=document.getElementById('c-first').value.trim();
  const last =document.getElementById('c-last').value.trim();
  if(!first||!last){alert('Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÎŒÎ½Î¿Î¼Î± ÎºÎ±Î¹ Î•Ï€ÏÎ½Ï…Î¼Î¿.');return;}
  document.getElementById('chip-avatar').textContent=(first[0]+last[0]).toUpperCase();
  document.getElementById('chip-name').textContent=first+' '+last;
  const co=document.getElementById('c-company').value.trim();
  const em=document.getElementById('c-email').value.trim();
  const mo=document.getElementById('c-mobile').value.trim();
  document.getElementById('chip-sub').textContent=co||em||mo||'â€”';
  saveState(); renderCart(); goTo('home');
}

// Î•Î¹ÎºÏŒÎ½ÎµÏ‚ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½ â€” ÏƒÏ…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Î¼Îµ paths Î¼ÏŒÎ»Î¹Ï‚ Î­Ï‡ÎµÎ¹Ï‚ Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯ÎµÏ‚
const PRODUCT_IMAGES = {
  // 'tenta_antirides': 'images/antirides.jpg',
  // 'tenta_yfasma':    'images/yfasma.jpg',
  // Îº.Î¿.Îº.
};

function buildProductList() {
  const container = document.getElementById('productList');
  container.innerHTML = '';
  PRODUCTS.forEach(cat => {
    const card   = document.createElement('div'); card.className = 'cat-card';
    const header = document.createElement('div'); header.className = 'cat-header';
    header.innerHTML = `<div class="cat-left"><span class="cat-icon">${cat.icon}</span><span class="cat-name">${cat.name}</span></div><span class="expand-icon" id="exp-${cat.id}">â–¸</span>`;
    const body = document.createElement('div'); body.className = 'cat-body'; body.style.display = 'none';
    const grid = document.createElement('div'); grid.className = 'prod-grid';
    cat.subs.forEach(sub => {
      if (sub.subs) {
        // nested sub-category: label spanning full width + tiles for children
        const lbl = document.createElement('div');
        lbl.style.cssText = 'grid-column:1/-1;padding:8px 4px 2px;color:var(--muted);font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.8px';
        lbl.textContent = sub.name;
        grid.appendChild(lbl);
        sub.subs.forEach(leaf => grid.appendChild(makeTile(leaf, cat)));
      } else {
        grid.appendChild(makeTile(sub, cat));
      }
    });
    body.appendChild(grid);
    header.onclick = () => { const o = body.style.display !== 'none'; body.style.display = o ? 'none' : 'block'; document.getElementById('exp-' + cat.id).textContent = o ? 'â–¸' : 'â–¾'; };
    card.appendChild(header); card.appendChild(body); container.appendChild(card);
  });
}

function makeTile(product, category) {
  const tile   = document.createElement('div'); tile.className = 'prod-tile';
  const imgBox = document.createElement('div'); imgBox.className = 'prod-tile-img';
  const imgSrc = PRODUCT_IMAGES[product.id];
  if (imgSrc) {
    const img = document.createElement('img'); img.src = imgSrc; img.alt = product.name;
    img.onerror = () => { img.remove(); imgBox.textContent = category.icon || 'ğŸ“¦'; };
    imgBox.appendChild(img);
  } else {
    imgBox.textContent = category.icon || 'ğŸ“¦';
  }
  const lbl = document.createElement('div'); lbl.className = 'prod-tile-name';
  lbl.textContent = product.name;
  tile.appendChild(imgBox); tile.appendChild(lbl);
  tile.onclick = () => selectProduct(product, category);
  return tile;
}

function selectProduct(product,category){
  currentProduct=product; currentCategory=category;
  currentQty=1; priceCalculated=false; lastCalcResult=null;
  sel={mechanism:null,axonas:null,fabric:null,manivela:null,thiki:null,glossa:null,typosGlossis:null};
  opt={entatiras:false,motor:false,xoufta:false,xouftaImanta:false};
  setaCount=2;
  document.getElementById('pf-category').textContent=category.name;
  document.getElementById('pf-name').textContent=product.name;
  document.getElementById('pf-notes').value='';
  document.getElementById('price-result').style.display='none';
  document.getElementById('add-another-btn').style.display='none';
  const isAntirides = product.id==='tenta_antirides';
  const isYfasma    = product.id==='tenta_yfasma';
  document.getElementById('antirides-section').style.display = isAntirides?'block':'none';
  document.getElementById('yfasma-section').style.display    = isYfasma?'block':'none';
  const fieldsEl=document.getElementById('pf-fields');
  fieldsEl.innerHTML='';
  product.dims.forEach(dim=>{
    const row=document.createElement('div'); row.className='field-row';
    row.innerHTML=`<label class="field-label">${DIM_LABELS[dim]}</label><input class="field-input" id="dim-${dim}" type="number" placeholder="${DIM_PHOLDER[dim]||'0'}" min="1" step="1" oninput="onDimChange()">`;
    fieldsEl.appendChild(row);
  });
  if(isAntirides){
    buildDropdown('dd-mechanism','mechanism',DB.mechanisms,(i)=>`${i.name}`,i=>`${i.price}â‚¬/Ï„ÎµÎ¼.`);
    buildDropdown('dd-axonas','axonas',DB.axones,(i)=>i.name,i=>`${i.pricePerM}â‚¬/Î¼.`);
    buildDropdown('dd-fabric-antirides','fabric',DB.fabrics,(i)=>i.name,i=>`${i.pricePerSqm}â‚¬/Ï„.Î¼.`);
    buildDropdown('dd-manivela','manivela',DB.maniveles,(i)=>i.name,i=>`${i.price}â‚¬`);
    buildSimpleList('sl-thiki','thiki',DB.thiki);
    buildSimpleList('sl-glossa','glossa',DB.glossa);
    buildSimpleList('sl-typosGlossis','typosGlossis',DB.typosGlossis);
    ['sw-entatiras','sw-motor','sw-xoufta','sw-xoufta-imanta'].forEach(id=>{
      const el=document.getElementById(id); if(el) el.classList.remove('on');
    });
    // Reset Ï‡Î¿ÏÏ†Ï„ÎµÏ‚ qty inputs
    ['qty-xoufta','qty-xoufta-imanta'].forEach(id=>{
      const el=document.getElementById(id); if(el){el.value=1;el.style.display='none';}
    });
    // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ ÎºÏÏ…Î¼Î¼Î­Î½Ï‰Î½ sections Î±Ï€ÏŒ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· ÎµÏ€Î¹Î»Î¿Î³Î®
    document.getElementById('dd-mechanism').style.display='block';
    document.getElementById('label-mechanism').style.display='block';
    document.getElementById('toggle-entatiras').style.display='flex';
    document.getElementById('manivela-section').style.display='block';
    document.getElementById('xeiristirio-section').style.display='none';
    if(document.getElementById('pf-xeiristirio')) document.getElementById('pf-xeiristirio').value='';
    document.getElementById('seta-question').style.display='none';
  }
  if(isYfasma){
    buildDropdown('dd-fabric-yfasma','fabric',DB.fabrics,(i)=>i.name,i=>`${i.pricePerSqm}â‚¬/Ï„.Î¼.`);
  }
  goTo('product');
}

function buildDropdown(containerId, selKey, items, nameFn, priceFn){
  const container=document.getElementById(containerId);
  const uid=containerId;
  container.innerHTML=`
    <div class="dropdown-wrap" id="dw-${uid}">
      <div class="dropdown-selected" onclick="toggleDD('${uid}')">
        <div>
          <div class="dropdown-placeholder" id="dp-${uid}">Î•Ï€Î¯Î»ÎµÎ¾Îµ...</div>
          <div id="dsel-${uid}" style="display:none">
            <div class="dropdown-sel-main" id="dsm-${uid}"></div>
            <div class="dropdown-sel-sub"  id="dss-${uid}"></div>
          </div>
        </div>
        <span class="dropdown-chevron" id="dc-${uid}">â€º</span>
      </div>
      <div class="dropdown-list" id="dl-${uid}">
        ${items.map(item=>`
          <div class="dropdown-option" id="dopt-${uid}-${item.id}" onclick="selectDD('${uid}','${selKey}','${item.id}')">
            <div>
              <div class="dopt-name">${nameFn(item)}</div>
              <div class="dopt-price">${priceFn(item)}</div>
            </div>
            <span class="dopt-check">âœ“</span>
          </div>`).join('')}
      </div>
    </div>`;
}

function toggleDD(uid){
  const list=document.getElementById('dl-'+uid);
  const chev=document.getElementById('dc-'+uid);
  const open=list.classList.contains('open');
  document.querySelectorAll('.dropdown-list').forEach(l=>l.classList.remove('open'));
  document.querySelectorAll('.dropdown-chevron').forEach(c=>c.classList.remove('open'));
  if(!open){list.classList.add('open');chev.classList.add('open');}
}

function selectDD(uid, selKey, itemId){
  const allItems={mechanism:DB.mechanisms,axonas:DB.axones,fabric:DB.fabrics,manivela:DB.maniveles};
  const item=allItems[selKey].find(i=>i.id===itemId);
  if(!item) return;
  sel[selKey]=item;
  document.getElementById('dp-'+uid).style.display='none';
  document.getElementById('dsel-'+uid).style.display='block';
  document.getElementById('dsm-'+uid).textContent=item.name;
  const priceFns={mechanism:i=>`${i.price}â‚¬/Ï„ÎµÎ¼.`,axonas:i=>`${i.pricePerM}â‚¬/Î¼.`,fabric:i=>`${i.pricePerSqm}â‚¬/Ï„.Î¼.`,manivela:i=>`${i.price}â‚¬`};
  document.getElementById('dss-'+uid).textContent=priceFns[selKey](item);
  document.querySelectorAll(`[id^="dopt-${uid}-"]`).forEach(el=>el.classList.remove('active'));
  document.getElementById(`dopt-${uid}-${itemId}`)?.classList.add('active');
  document.getElementById('dl-'+uid).classList.remove('open');
  document.getElementById('dc-'+uid).classList.remove('open');
  if(selKey==='mechanism') onDimChange();
  priceCalculated=false;
  document.getElementById('price-result').style.display='none';
}

function onDimChange(){
  if(currentProduct?.id!=='tenta_antirides') return;
  const w=parseFloat(document.getElementById('dim-width')?.value)||0;
  const setaQ=document.getElementById('seta-question');
  if(w>500){setaQ.style.display='block';buildSetaOptions(w);}
  else{setaQ.style.display='none';setaCount=2;}
  priceCalculated=false;
  document.getElementById('price-result').style.display='none';
}

function buildSetaOptions(width){
  const opts=document.getElementById('seta-options');
  const maxSeta=Math.ceil(width/200)+1;
  opts.innerHTML='';
  for(let i=2;i<=Math.max(maxSeta,4);i++){
    const btn=document.createElement('div');
    btn.className='seta-opt'+(setaCount===i?' active':'');
    btn.textContent=i+' Î£ÎµÏ„';
    btn.onclick=()=>{
      setaCount=i;
      document.querySelectorAll('.seta-opt').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      priceCalculated=false;
      document.getElementById('price-result').style.display='none';
    };
    opts.appendChild(btn);
  }
}

function toggleEntatiras(){
  if(opt.motor) return;
  opt.entatiras=!opt.entatiras;
  document.getElementById('sw-entatiras').classList.toggle('on',opt.entatiras);
  const hide=opt.entatiras;
  document.getElementById('label-mechanism').style.display=hide?'none':'block';
  document.getElementById('dd-mechanism').style.display   =hide?'none':'block';
  // ÎœÎ±Î½Î¹Î²Î­Î»Î± Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Î¿ÏÎ±Ï„Î® Î¼Îµ ÎµÎ½Ï„Î±Ï„Î®ÏÎ±
  priceCalculated=false;
  document.getElementById('price-result').style.display='none';
}

function toggleMotor(){
  opt.motor=!opt.motor;
  document.getElementById('sw-motor').classList.toggle('on',opt.motor);
  if(opt.motor){
    // ÎœÎ¿Ï„Î­Ï ON â†’ Î¼Î·Î´ÎµÎ½Î¯Î¶ÎµÎ¹ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ, ÎµÎ½Ï„Î±Ï„Î®ÏÎ±, Î¼Î±Î½Î¹Î²Î­Î»Î±
    opt.entatiras=false;
    document.getElementById('sw-entatiras').classList.remove('on');
    sel.manivela=null;
    // ÎšÏÏÎ²ÎµÎ¹ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ + ÎµÎ½Ï„Î±Ï„Î®ÏÎ± + Î¼Î±Î½Î¹Î²Î­Î»Î±, ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÎ¹ Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®ÏÎ¹Î¿
    document.getElementById('dd-mechanism').style.display  ='none';
    document.getElementById('label-mechanism').style.display='none';
    document.getElementById('toggle-entatiras').style.display='none';
    document.getElementById('manivela-section').style.display='none';
    document.getElementById('xeiristirio-section').style.display='block';
  } else {
    document.getElementById('dd-mechanism').style.display  ='block';
    document.getElementById('label-mechanism').style.display='block';
    document.getElementById('toggle-entatiras').style.display='flex';
    document.getElementById('manivela-section').style.display='block';
    document.getElementById('xeiristirio-section').style.display='none';
    if(document.getElementById('pf-xeiristirio')) document.getElementById('pf-xeiristirio').value='';
  }
  priceCalculated=false;
  document.getElementById('price-result').style.display='none';
}

function toggleSwitch(id){
  const sw=document.getElementById(id);
  const key=id==='sw-motor'?'motor':id==='sw-xoufta'?'xoufta':'xouftaImanta';
  opt[key]=!opt[key];
  sw.classList.toggle('on',opt[key]);
  // Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· input Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î±Ï‚ Î³Î¹Î± Ï‡Î¿ÏÏ†Ï„ÎµÏ‚
  if(id==='sw-xoufta'){
    const inp=document.getElementById('qty-xoufta');
    if(inp){ inp.style.display=opt[key]?'block':'none'; if(!opt[key]) inp.value=1; }
  }
  if(id==='sw-xoufta-imanta'){
    const inp=document.getElementById('qty-xoufta-imanta');
    if(inp){ inp.style.display=opt[key]?'block':'none'; if(!opt[key]) inp.value=1; }
  }
  priceCalculated=false;
  document.getElementById('price-result').style.display='none';
}

function calcPrice(){
  const widthCm=parseFloat(document.getElementById('dim-width')?.value)||0;
  const projCm =parseFloat(document.getElementById('dim-projection')?.value||document.getElementById('dim-height')?.value)||0;
  if(!widthCm||!projCm){alert('Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î¹Ï‚ Î´Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚.');return;}

  if(currentProduct.id==='tenta_yfasma'){
    if(!sel.fabric){alert('Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï€Î±Î½Î¯.');return;}
    const f=sel.fabric;
    const sqm=(widthCm/100)*((projCm+70)/100);
    const raw=sqm*f.pricePerSqm;
    const final=Math.max(raw,DB.minCharge);
    const minApplied=raw<DB.minCharge;
    const sheets=Math.floor((widthCm+5)/(f.width-2));
    const tsonta=(widthCm+5)-(sheets*(f.width-2));
    document.getElementById('pricing-breakdown').innerHTML=
      cRow('Î Î»Î¬Ï„Î¿Ï‚',widthCm+' cm')+cRow('Î ÏÎ¿Î²Î¿Î»Î® + 70cm',(projCm+70)+' cm')+
      cRow('Î¤.Î¼. Ï…Ï†Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚',sqm.toFixed(3)+' Ï„.Î¼.')+cRow('Î Î±Î½Î¯: '+f.name,f.pricePerSqm+' â‚¬/Ï„.Î¼.')+
      cRow('Î‘Î¾Î¯Î± Ï…Ï†Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚',raw.toFixed(2)+' â‚¬')+
      (minApplied?cRow('âš ï¸ Î•Î»Î¬Ï‡Î¹ÏƒÏ„Î· Ï‡ÏÎ­Ï‰ÏƒÎ·',DB.minCharge+' â‚¬','highlight'):'');
    document.getElementById('production-section').style.display='block';
    document.getElementById('production-iron').innerHTML=cRow('â€”','Î”ÎµÎ½ ÎµÏ†Î±ÏÎ¼ÏŒÎ¶ÎµÏ„Î±Î¹');
    document.getElementById('production-fabric').innerHTML=
      cRow('Î Î»Î¬Ï„Î¿Ï‚ Ï…Ï†Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚',widthCm+' cm')+cRow('ÎÏˆÎ¿Ï‚ Ï…Ï†Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚',(projCm+70)+' cm')+
      cRow('Î¦ÏÎ»Î»Î±',sheets+' Ï†ÏÎ»Î»Î± Ã— '+(projCm+70)+' cm')+
      (tsonta>0.5?cRow('Î¤ÏƒÏŒÎ½Ï„Î±',tsonta.toFixed(1)+' cm Ã— '+(projCm+70)+' cm'):'');
    document.getElementById('production-alerts').innerHTML=
      `<div class="calc-alert production">ğŸ§µ Î§ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ <strong>${sheets} Ï†ÏÎ»Î»${sheets===1?'Î¿':'Î±'}</strong> ${f.name} Ã— ${projCm+70} cm`+
      (tsonta>0.5?` + Ï„ÏƒÏŒÎ½Ï„Î± <strong>${tsonta.toFixed(1)} cm</strong> Ã— ${projCm+70} cm`:'')+'</div>';
    lastCalcResult={
      final, production:{ sheets, tsonta, projCm, f, widthCm },
      productionData: {
        type: 'yfasma',
        fabric: f.name, fabricWidth: widthCm, fabricHeight: projCm+70,
        sheets, tsonta: tsonta > 0.5 ? tsonta : 0,
      }
    };
    showResult(final,minApplied);
    return;
  }

  if(currentProduct.id==='tenta_antirides'){
    if(!sel.axonas)   {alert('Î•Ï€Î¯Î»ÎµÎ¾Îµ Î¬Î¾Î¿Î½Î±.');return;}
    if(!sel.fabric)   {alert('Î•Ï€Î¯Î»ÎµÎ¾Îµ ÏÏ†Î±ÏƒÎ¼Î±.');return;}
    if(!opt.motor&&!opt.entatiras&&!sel.mechanism){alert('Î•Ï€Î¯Î»ÎµÎ¾Îµ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ.');return;}
    if(!opt.motor&&!sel.manivela){alert('Î•Ï€Î¯Î»ÎµÎ¾Îµ Î¼Î±Î½Î¹Î²Î­Î»Î± Î® ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ Î¼Î¿Ï„Î­Ï.');return;}
    const mech=opt.entatiras?DB.entatiras:sel.mechanism;
    const axon=sel.axonas, f=sel.fabric;
    const mechWidth = opt.motor ? (DB.motor?.width||0) : (mech?.width||0);
    const axonasCm=widthCm-mechWidth, axonasM=axonasCm/100;
    if(axonasCm<=0){
      alert(`âŒ Î Î»Î¬Ï„Î¿Ï‚ Ï€Î¿Î»Ï Î¼Î¹ÎºÏÏŒ!\nÎŸ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚ ${mech?.name||''} Î­Ï‡ÎµÎ¹ Ï€Î»Î¬Ï„Î¿Ï‚ ${mechWidth}cm.\nÎ¤Î¿ ÏƒÏ…Î½Î¿Î»Î¹ÎºÏŒ Ï€Î»Î¬Ï„Î¿Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ ${mechWidth+10}cm.\n\nğŸ’¡ Î˜Ï…Î¼Î®ÏƒÎ¿Ï…: ÎµÎ¹ÏƒÎ¬Î³ÎµÎ¹Ï‚ Î´Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ ÏƒÎµ Î•ÎšÎ‘Î¤ÎŸÎ£Î¤Î‘.`);
      return;
    }
    if(widthCm<50||projCm<30){
      alert('âŒ Î”Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Ï€Î¿Î»Ï Î¼Î¹ÎºÏÎ­Ï‚.\nÎ•Î¹ÏƒÎ¬Î³ÎµÎ¹Ï‚ Î´Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ ÏƒÎµ ÎµÎºÎ±Ï„Î¿ÏƒÏ„Î¬ (cm).\nÎ .Ï‡. 300 Î³Î¹Î± 3 Î¼Î­Ï„ÏÎ± Ï€Î»Î¬Ï„Î¿Ï‚.');
      return;
    }
    const numSeta=widthCm<=500?2:setaCount;
    const solinaCm=projCm, solinaM=solinaCm/100;
    const fabricWidthCm=axonasCm-2, fabricHeightCm=projCm+70;
    const sqm=(fabricWidthCm/100)*(fabricHeightCm/100);
    const sheets=Math.floor((fabricWidthCm+5)/(f.width-2));
    const tsonta=(fabricWidthCm+5)-(sheets*(f.width-2));
    const qtyXoufta  = opt.xoufta       ? (parseInt(document.getElementById('qty-xoufta')?.value)||1)        : 0;
    const qtyImanta  = opt.xouftaImanta ? (parseInt(document.getElementById('qty-xoufta-imanta')?.value)||1) : 0;
    const xAloum = DB.xouftes.find(x=>x.id==='XouftaAlouminiou');
    const xImanta= DB.xouftes.find(x=>x.id==='XouftaImanta');
    // Î£Ï„ÏÎ¹Ï†ÏÎ½Î¹Î±/ÎŸÏÏ€Î± = Î¬Î¸ÏÎ¿Î¹ÏƒÎ¼Î± Î±Ï€ÏŒ ÎºÎ¬Î¸Îµ ÎµÎ¾Î¬ÏÏ„Î·Î¼Î± (Î±Ï€ÏŒ DB)
    const totalStrifonia =
      (opt.motor ? (DB.motor?.strifonia||0) : (mech?.strifonia||0)) +
      (!opt.motor && !opt.entatiras ? (DB.kouzineto?.strifonia||0) : 0) +
      qtyXoufta  * (xAloum?.strifonia||0) +
      qtyImanta  * (xImanta?.strifonia||0) +
      numSeta    * (DB.setAntiridas?.strifonia||0);
    let lines=[], total=0;
    const add=(label,price,qty=1,unit='')=>{
      if(qty===0) return;
      const t=price*qty; total+=t;
      lines.push(cRow(label+(qty!==1?` Ã— ${typeof qty==='number'?qty.toFixed(qty%1?2:0):qty}${unit}`:''),t.toFixed(2)+' â‚¬'));
    };
    if(opt.motor&&DB.motor)  add(DB.motor.name,DB.motor.price);
    else if(opt.entatiras)   add('Î•Î½Ï„Î±Ï„Î®ÏÎ±Ï‚',DB.entatiras.price);
    else if(mech)           {add('ÎœÎ·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚: '+mech.name,mech.price);add('ÎšÎ¿Ï…Î¶Î¹Î½Î­Ï„Î¿',DB.kouzineto.price,DB.kouzineto.qty);}
    add('Î†Î¾Î¿Î½Î±Ï‚ '+axon.name,axon.pricePerM,axonasM,' Î¼.');
    add('Î‘Î½Ï„Î¯Î²Î±ÏÎ¿ ('+DB.antivaro.name+')',DB.antivaro.pricePerM,axonasM,' Î¼.');
    add('Î£ÎµÏ„ Î‘Î½Ï„Î¹ÏÎ¯Î´Î±Ï‚',DB.setAntiridas.price,numSeta);
    add('ÎšÎ¿Î»Î¿Î½Î¬ÎºÎ¹',DB.kolonaki.price,numSeta);
    add('Î£Ï‰Î»Î®Î½Î± Î‘Î»Î¿Ï…Î¼Î¹Î½Î¯Î¿Ï…',DB.solinaAloum.pricePerM,solinaM*numSeta,' Î¼.');
    add('Î£Ï„ÏÎ¹Ï†ÏÎ½Î¹Î±',DB.strifonia.price,totalStrifonia);
    add('ÎŸÏÏ€Î±',DB.oupa.price,totalStrifonia);
    add('Î¤Î¬Ï€ÎµÏ‚',DB.tapes.price,2);
    if(!opt.motor&&sel.manivela) add('ÎœÎ±Î½Î¹Î²Î­Î»Î±: '+sel.manivela.name,sel.manivela.price);
    if(opt.xoufta){const x=DB.xouftes.find(x=>x.id==='XouftaAlouminiou');if(x)add(x.name,x.price,qtyXoufta);}
    if(opt.xouftaImanta){const x=DB.xouftes.find(x=>x.id==='XouftaImanta');if(x)add(x.name,x.price,qtyImanta);}
    add('ÎÏ†Î±ÏƒÎ¼Î± '+f.name,f.pricePerSqm,sqm,' Ï„.Î¼.');
    const final=Math.max(total,DB.minCharge);
    document.getElementById('pricing-breakdown').innerHTML=lines.join('')+cRow('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€','')+cRow('Î£ÏÎ½Î¿Î»Î¿ Ï…Î»Î¹ÎºÏÎ½',total.toFixed(2)+' â‚¬','highlight');
    document.getElementById('production-section').style.display='block';
    // Î£Î¹Î´Î·ÏÎ¿ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î® â€” ÏŒÎ»ÎµÏ‚ Î¿Î¹ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î¹Î¼Î­Ï‚
    const pRow=(label,value)=>`<div class="calc-row"><span class="calc-label">${label}</span><span class="calc-value">${value}</span></div>`;
    let iron='';
    if(opt.motor)          iron+=pRow('ÎœÎ¿Ï„Î­Ï','ÎœÎ¿Ï„Î­Ï Î¼Îµ Î‘Î½Ï„Î¯Î»Î·ÏˆÎ·');
    else if(opt.entatiras) iron+=pRow('ÎœÎ·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚','Î•Î½Ï„Î±Ï„Î®ÏÎ±Ï‚');
    else if(mech)         {iron+=pRow('ÎœÎ·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚',mech.name); iron+=pRow('ÎšÎ¿Ï…Î¶Î¹Î½Î­Ï„Î¿','1 Ï„ÎµÎ¼.');}
    iron+=pRow('Î†Î¾Î¿Î½Î±Ï‚',axon.name+' â€” '+axonasCm.toFixed(1)+' cm');
    iron+=pRow('Î‘Î½Ï„Î¯Î²Î±ÏÎ¿',DB.antivaro.name+' â€” '+axonasCm.toFixed(1)+' cm');
    iron+=pRow('Î£ÎµÏ„ Î‘Î½Ï„Î¹ÏÎ¯Î´Î±Ï‚',numSeta+' ÏƒÎµÏ„');
    iron+=pRow('ÎšÎ¿Î»Î¿Î½Î¬ÎºÎ¹',numSeta+' Ï„ÎµÎ¼.');
    iron+=pRow('Î£Ï‰Î»Î®Î½Î± Î‘Î»Î¿Ï…Î¼Î¹Î½Î¯Î¿Ï…',numSeta+' Ã— '+solinaCm+' cm');
    if(totalStrifonia>0) iron+=pRow('Î£Ï„ÏÎ¹Ï†ÏÎ½Î¹Î±',totalStrifonia+' Ï„ÎµÎ¼.');
    if(totalStrifonia>0) iron+=pRow('ÎŸÏÏ€Î±',totalStrifonia+' Ï„ÎµÎ¼.');
    iron+=pRow('Î¤Î¬Ï€ÎµÏ‚','2 Ï„ÎµÎ¼.');
    if(!opt.motor&&sel.manivela) iron+=pRow('ÎœÎ±Î½Î¹Î²Î­Î»Î±',sel.manivela.name);
    if(opt.xoufta&&xAloum)  iron+=pRow('Î§Î¿ÏÏ†Ï„Î± Î‘Î»Î¿Ï…Î¼Î¹Î½Î¯Î¿Ï…',qtyXoufta+' Ï„ÎµÎ¼.');
    if(opt.xouftaImanta&&xImanta) iron+=pRow('Î§Î¿ÏÏ†Ï„Î± Î™Î¼Î¬Î½Ï„Î±Ï‚',qtyImanta+' Ï„ÎµÎ¼.');
    document.getElementById('production-iron').innerHTML=iron;
    document.getElementById('production-fabric').innerHTML=
      cRow('Î Î»Î¬Ï„Î¿Ï‚ Ï…Ï†Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚',fabricWidthCm.toFixed(1)+' cm')+cRow('ÎÏˆÎ¿Ï‚ Ï…Ï†Î¬ÏƒÎ¼Î±Ï„Î¿Ï‚',fabricHeightCm+' cm')+
      cRow('Î¦ÏÎ»Î»Î±',sheets+' Ã— '+fabricHeightCm+' cm')+
      (tsonta>0.5?cRow('Î¤ÏƒÏŒÎ½Ï„Î±',tsonta.toFixed(1)+' Ã— '+fabricHeightCm+' cm'):'')+
      (sel.thiki       ?cRow('Î˜Î®ÎºÎ·',sel.thiki.name):'')+
      (sel.glossa      ?cRow('Î“Î»ÏÏƒÏƒÎ±',sel.glossa.name):'')+
      (sel.typosGlossis?cRow('Î¤ÏÏ€Î¿Ï‚ Î“Î»ÏÏƒÏƒÎ±Ï‚',sel.typosGlossis.name):'');
    document.getElementById('production-alerts').innerHTML=
      `<div class="calc-alert">ğŸ”© Î†Î¾Î¿Î½Î±Ï‚ & Î‘Î½Ï„Î¯Î²Î±ÏÎ¿: <strong>${axonasCm.toFixed(1)} cm</strong> | ${numSeta} Î£ÎµÏ„ Î‘Î½Ï„Î¹ÏÎ¯Î´Î±Ï‚ | ${numSeta} Î£Ï‰Î»Î®Î½ÎµÏ‚ <strong>${solinaCm} cm</strong></div>`+
      `<div class="calc-alert production">ğŸ§µ <strong>${sheets} Ï†ÏÎ»Î»${sheets===1?'Î¿':'Î±'}</strong> ${f.name} Ã— ${fabricHeightCm} cm`+
      (tsonta>0.5?` + Ï„ÏƒÏŒÎ½Ï„Î± <strong>${tsonta.toFixed(1)} cm</strong>`:'')+'</div>';
    lastCalcResult={
      final, total,
      productionData: {
        type: 'antirides',
        mechanism: opt.motor ? DB.motor.name : opt.entatiras ? 'Î•Î½Ï„Î±Ï„Î®ÏÎ±Ï‚' : mech?.name,
        kouzineto: (!opt.motor && !opt.entatiras) ? '1 Ï„ÎµÎ¼.' : null,
        axon: axon.name, axonCm: axonasCm,
        antivaro: DB.antivaro.name, antivaroCm: axonasCm,
        numSeta, solinaCm,
        strifonia: totalStrifonia > 0 ? totalStrifonia + ' Ï„ÎµÎ¼.' : null,
        oupa: totalStrifonia > 0 ? totalStrifonia + ' Ï„ÎµÎ¼.' : null,
        tapes: '2 Ï„ÎµÎ¼.',
        manivela: (!opt.motor && sel.manivela) ? sel.manivela.name : null,
        xouftaAloum: (opt.xoufta && xAloum) ? qtyXoufta + ' Ï„ÎµÎ¼.' : null,
        xouftaImanta: (opt.xouftaImanta && xImanta) ? qtyImanta + ' Ï„ÎµÎ¼.' : null,
        fabric: f.name, fabricWidth: fabricWidthCm, fabricHeight: fabricHeightCm,
        sheets, tsonta: tsonta > 0.5 ? tsonta : 0,
        thiki: sel.thiki?.name||null, glossa: sel.glossa?.name||null, typosGlossis: sel.typosGlossis?.name||null,
      }
    };
    showResult(final, false);
    return;
  }

  showResult(0,false);
  document.getElementById('pricing-breakdown').innerHTML=cRow('âš ï¸ Î¤Î¹Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ· Ï…Ï€ÏŒ ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î®','0.00 â‚¬');
}

function buildSimpleList(containerId, selKey, items){
  const el=document.getElementById(containerId);
  if(!el||!items||!items.length){if(el)el.innerHTML='<span style="color:var(--muted);font-size:12px">â€”</span>';return;}
  el.innerHTML=items.map(item=>`<button class="simple-pill${sel[selKey]?.id===item.id?' active':''}" onclick="pickSimple('${containerId}','${selKey}','${item.id}')">${item.name}</button>`).join('');
}

function pickSimple(containerId, selKey, itemId){
  const allLists={thiki:DB.thiki, glossa:DB.glossa, typosGlossis:DB.typosGlossis};
  const items=allLists[selKey]||[];
  sel[selKey]=items.find(i=>i.id===itemId)||null;
  document.querySelectorAll(`#${containerId} .simple-pill`).forEach(b=>b.classList.remove('active'));
  document.querySelector(`#${containerId} .simple-pill[onclick*="'${itemId}'"]`)?.classList.add('active');
  priceCalculated=false;
  document.getElementById('price-result').style.display='none';
}

function cRow(label,value,cls=''){
  return `<div class="calc-row"><span class="calc-label">${label}</span><span class="calc-value${cls?' '+cls:''}">${value}</span></div>`;
}

function showResult(price,minApplied){
  priceCalculated=true;
  window._currentPrice=price;
  document.getElementById('price-result').style.display='block';
  document.getElementById('price-display').textContent=price.toFixed(2)+' â‚¬';
  document.getElementById('price-warning').style.display=minApplied?'block':'none';
  document.getElementById('add-another-btn').style.display='block';
}

function _buildCartItem(){
  if(!priceCalculated){alert('Î Î¬Ï„Î± "Î¥Ï€Î¿Î»ÏŒÎ³Î¹ÏƒÎµ Î¤Î¹Î¼Î®" Ï€ÏÏÏ„Î±.');return null;}
  const widthCm=parseFloat(document.getElementById('dim-width')?.value)||0;
  const projCm =parseFloat(document.getElementById('dim-projection')?.value||document.getElementById('dim-height')?.value)||0;
  const sub=sel.fabric?sel.fabric.name:(sel.mechanism?sel.mechanism.name:'');
  return {
    id:Date.now(), productId:currentProduct.id,
    fullName:currentCategory.name+' â€º '+currentProduct.name,
    dims:{width:widthCm,projection:projCm}, secondKey:'projection', quantity:currentQty,
    fabric:sel.fabric?.name||'', color:'',
    notes:document.getElementById('pf-notes').value.trim(),
    price:window._currentPrice, sub,
    production:lastCalcResult?.production||null,
    productionData:lastCalcResult?.productionData||null,
  };
}

function addToOffer(){
  const item=_buildCartItem(); if(!item)return;
  cart.push(item); currentOfferNum=null; saveState(); renderCart(); goTo('home');
  setTimeout(()=>{document.getElementById('view-cart-bar').style.transform='scale(1.02)';},50);
  setTimeout(()=>{document.getElementById('view-cart-bar').style.transform='scale(1)';},250);
}

function addAndPickAnother(){
  const item=_buildCartItem(); if(!item)return;
  cart.push(item); currentOfferNum=null; saveState(); renderCart(); goTo('home');
  document.getElementById('screen-home').querySelector('.scroll-area').scrollTo(0,0);
}

function removeFromCart(id){cart=cart.filter(i=>i.id!==id);saveState();renderCart();}

function renderCart(){
  const cs=document.getElementById('cart-section');
  const cb=document.getElementById('view-cart-bar');
  const li=document.getElementById('cart-items-list');
  if(cart.length===0){cs.style.display='none';cb.style.display='none';return;}
  cs.style.display='block'; cb.style.display='flex';
  const net=cart.reduce((s,i)=>s+i.price,0);
  document.getElementById('cart-total-display').textContent=(net*(1+VAT)).toFixed(2)+' â‚¬';
  li.innerHTML='';
  cart.forEach(item=>{
    const row=document.createElement('div'); row.className='cart-item-row';
    const dims=`${item.dims.width}cm Ã— ${item.dims.projection||item.dims.height||0}cm`;
    row.innerHTML=`<div class="cart-item-info"><div class="cart-item-name">${item.fullName}</div><div class="cart-item-dims">${dims}${item.sub?' Â· '+item.sub:''}</div></div><span class="cart-item-price">${item.price.toFixed(2)} â‚¬</span><button class="cart-item-del" onclick="removeFromCart(${item.id})">Ã—</button>`;
    li.appendChild(row);
  });
}

function goToPreview(){
  if(cart.length===0){alert('Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î­Î½Î± Ï€ÏÎ¿ÏŠÏŒÎ½.');return;}
  if(!currentOfferNum) currentOfferNum='OFR-'+new Date().toISOString().slice(0,10).replace(/-/g,'')+'-'+String(offerCounter++).padStart(3,'0');
  document.getElementById('prev-offernum').textContent='Î‘Ï. Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚: '+currentOfferNum;
  document.getElementById('prev-date').textContent='Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±: '+new Date().toLocaleDateString('el-GR');
  const g=id=>document.getElementById(id).value.trim();
  const first=g('c-first'),last=g('c-last'),company=g('c-company'),email=g('c-email'),
        mobile=g('c-mobile'),phone=g('c-phone'),address=g('c-address'),city=g('c-city'),afm=g('c-afm');
  let cHtml=dRow('ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿',first+' '+last,true);
  if(company) cHtml+=dRow('Î•Ï„Î±Î¹ÏÎµÎ¯Î±',company);
  if(email)   cHtml+=dRow('Email',email);
  if(mobile)  cHtml+=dRow('ÎšÎ¹Î½Î·Ï„ÏŒ',mobile);
  if(phone)   cHtml+=dRow('Î¤Î·Î»Î­Ï†Ï‰Î½Î¿',phone);
  if(address||city) cHtml+=dRow('Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·',[address,city].filter(Boolean).join(', '));
  if(afm)     cHtml+=dRow('Î‘Î¦Îœ',afm);
  document.getElementById('prev-customer').innerHTML=cHtml;
  const itemsEl=document.getElementById('prev-items'); itemsEl.innerHTML='';
  cart.forEach((item,i)=>{
    const div=document.createElement('div'); div.className='item-card';
    let rows=dRow('Î”Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚',item.dims.width+'cm Ã— '+(item.dims.projection||item.dims.height||0)+'cm');
    if(item.fabric) rows+=dRow('Î Î±Î½Î¯',item.fabric);
    if(item.notes)  rows+=dRow('Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚',item.notes);
    div.innerHTML=`<div class="item-card-header"><span class="item-card-name">${i+1}. ${item.fullName}</span><span class="item-card-price">${item.price.toFixed(2)} â‚¬</span></div><div>${rows}</div>`;
    itemsEl.appendChild(div);
  });
  const net=cart.reduce((s,i)=>s+i.price,0);
  const vat=net*VAT, total=net+vat;
  document.getElementById('prev-net').textContent=net.toFixed(2)+' â‚¬';
  document.getElementById('prev-vat').textContent=vat.toFixed(2)+' â‚¬';
  document.getElementById('prev-total').textContent=total.toFixed(2)+' â‚¬';
  const cnotes=g('c-notes');
  document.getElementById('prev-notes-section').style.display=cnotes?'block':'none';
  if(cnotes) document.getElementById('prev-notes').textContent=cnotes;
  const btn=document.getElementById('send-btn');
  btn.style.display='block'; btn.disabled=false; btn.textContent='ğŸ“§ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ÏƒÏ„Î¿Î½ Î ÎµÎ»Î¬Ï„Î·';
  const pbtn=document.getElementById('prod-btn');
  pbtn.style.display='block'; pbtn.disabled=false; pbtn.textContent='ğŸ­ Email Î Î±ÏÎ±Î³Ï‰Î³Î®Ï‚';
  document.getElementById('sent-banner').style.display='none';
  goTo('preview');
}

function dRow(label,value,bold=false){
  return `<div class="detail-row"><span class="detail-label">${label}</span><span class="detail-value${bold?' bold':''}">${value}</span></div>`;
}

function _buildEmailBodies(){
  const g = id => document.getElementById(id)?.value?.trim()||'';
  const first=g('c-first'), last=g('c-last'), company=g('c-company');
  const email=g('c-email'), mobile=g('c-mobile'), phone=g('c-phone');
  const address=g('c-address'), city=g('c-city'), afm=g('c-afm'), notes=g('c-notes');
  const net=cart.reduce((s,i)=>s+i.price,0), vat=net*VAT, total=net+vat;
  const dateStr=new Date().toLocaleDateString('el-GR');

  let bCustomer=`Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬: ${currentOfferNum}\nÎ—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±: ${dateStr}\n\nÎ£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Ï€ÎµÎ»Î¬Ï„Î·:\n`;
  bCustomer+=`ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿: ${first} ${last}\n`;
  if(company)      bCustomer+=`Î•Ï„Î±Î¹ÏÎµÎ¯Î±: ${company}\n`;
  if(email)        bCustomer+=`Email: ${email}\n`;
  if(mobile)       bCustomer+=`ÎšÎ¹Î½Î·Ï„ÏŒ: ${mobile}\n`;
  if(phone)        bCustomer+=`Î¤Î·Î»: ${phone}\n`;
  if(address||city)bCustomer+=`Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·: ${[address,city].filter(Boolean).join(', ')}\n`;
  if(afm)          bCustomer+=`Î‘Î¦Îœ: ${afm}\n`;
  bCustomer+=`\n--- Î ÏÎ¿ÏŠÏŒÎ½Ï„Î± ---\n`;
  cart.forEach((item,i)=>{
    bCustomer+=`\n${i+1}. ${item.fullName}\n`;
    bCustomer+=`   Î”Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚: ${item.dims.width}cm Ã— ${item.dims.projection||item.dims.height||0}cm\n`;
    if(item.fabric) bCustomer+=`   Î¥Ï†Î¬ÏƒÎ¼Î±: ${item.fabric}\n`;
    if(item.notes)  bCustomer+=`   Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚: ${item.notes}\n`;
    bCustomer+=`   Î¤Î¹Î¼Î®: ${item.price.toFixed(2)}â‚¬\n`;
  });
  bCustomer+=`\nÎšÎ±Î¸Î±ÏÎ® Î‘Î¾Î¯Î±: ${net.toFixed(2)}â‚¬\nÎ¦Î Î‘ 24%: ${vat.toFixed(2)}â‚¬\nÎ£Î¥ÎÎŸÎ›ÎŸ: ${total.toFixed(2)}â‚¬\n`;
  if(notes) bCustomer+=`\nÎ£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚: ${notes}\n`;

  let bProd=`=== Î Î‘Î¡Î‘Î“Î“Î•Î›Î™Î‘ Î Î‘Î¡Î‘Î“Î©Î“Î—Î£ ===\nÎ‘Ï. Î ÏÎ¿ÏƒÏ†.: ${currentOfferNum} | Î—Î¼/Î½Î¯Î±: ${dateStr}\n\n`;
  bProd+=`Î Î•Î›Î‘Î¤Î—Î£: ${first} ${last}`;
  if(company) bProd+=` | ${company}`;
  if(mobile)  bProd+=` | Î¤Î·Î»: ${mobile}`;
  if(email)   bProd+=` | Email: ${email}`;
  bProd+=`\n\n`;
  cart.forEach((item,i)=>{
    bProd+=`--- Î ÏÎ¿ÏŠÏŒÎ½ ${i+1}: ${item.fullName} ---\n`;
    bProd+=`Î”Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚: ${item.dims.width}cm Ã— ${item.dims.projection||item.dims.height||0}cm\n`;
    if(item.fabric) bProd+=`Î¥Ï†Î¬ÏƒÎ¼Î±: ${item.fabric}\n`;
    if(item.production){
      const p=item.production;
      if(p.sheets!==undefined){
        bProd+=`Î¦ÏÎ»Î»Î±: ${p.sheets} Ï†ÏÎ»Î»Î± Ã— ${(p.projCm||0)+70}cm`;
        if(p.tsonta>0.5) bProd+=` + Ï„ÏƒÏŒÎ½Ï„Î± ${p.tsonta.toFixed(1)}cm Ã— ${(p.projCm||0)+70}cm`;
        bProd+=`\n`;
      }
    }
    if(item.notes) bProd+=`Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚: ${item.notes}\n`;
    bProd+=`Î¤Î¹Î¼Î®: ${item.price.toFixed(2)}â‚¬\n\n`;
  });
  bProd+=`ÎšÎ±Î¸Î±ÏÎ® Î‘Î¾Î¯Î±: ${net.toFixed(2)}â‚¬ | Î¦Î Î‘: ${vat.toFixed(2)}â‚¬ | Î£Î¥ÎÎŸÎ›ÎŸ: ${total.toFixed(2)}â‚¬\n`;
  return { bCustomer, bProd, email, first, last, net, vat, total };
}

function _openMailto(mailto){
  const a = document.createElement('a');
  a.href = mailto;
  a.target = '_blank';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

function sendToCustomer(){
  const { bCustomer, email, first, last } = _buildEmailBodies();
  if(!email){ alert('âš ï¸ Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ email Ï€ÎµÎ»Î¬Ï„Î·.'); return; }
  const subj=encodeURIComponent(`Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬ ${currentOfferNum} - ${first} ${last}`);
  _openMailto(`mailto:${email}?subject=${subj}&body=${encodeURIComponent(bCustomer)}`);
  document.getElementById('sent-banner').style.display='block';
  const btn=document.getElementById('send-btn');
  btn.disabled=true; btn.textContent='âœ… Î•ÏƒÏ„Î¬Î»Î· ÏƒÏ„Î¿Î½ Î ÎµÎ»Î¬Ï„Î·';
}

function sendToProduction(){
  const g = id => document.getElementById(id)?.value?.trim()||'';
  const first=g('c-first'), last=g('c-last'), company=g('c-company');
  const mobile=g('c-mobile'), phone=g('c-phone'), address=g('c-address'), city=g('c-city');
  const email=g('c-email'), notes=g('c-notes');
  const dateStr=new Date().toLocaleDateString('el-GR');

  let b=`=== Î Î‘Î¡Î‘Î“Î“Î•Î›Î™Î‘ Î Î‘Î¡Î‘Î“Î©Î“Î—Î£ ===\n`;
  b+=`Î‘Ï. Î ÏÎ¿ÏƒÏ†Î¿ÏÎ¬Ï‚: ${currentOfferNum}\nÎ—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±: ${dateStr}\n\n`;
  b+=`--- Î£Î¤ÎŸÎ™Î§Î•Î™Î‘ Î Î•Î›Î‘Î¤Î— ---\n`;
  b+=`ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿: ${first} ${last}\n`;
  if(company)       b+=`Î•Ï„Î±Î¹ÏÎµÎ¯Î±: ${company}\n`;
  if(mobile)        b+=`ÎšÎ¹Î½Î·Ï„ÏŒ: ${mobile}\n`;
  if(phone)         b+=`Î¤Î·Î»: ${phone}\n`;
  if(address||city) b+=`Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·: ${[address,city].filter(Boolean).join(', ')}\n`;
  if(email)         b+=`Email: ${email}\n`;
  b+=`\n`;

  cart.forEach((item,i)=>{
    b+=`${'='.repeat(40)}\n`;
    b+=`Î Î¡ÎŸÎ™ÎŸÎ ${i+1}: ${item.fullName}\n`;
    b+=`Î”Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚: ${item.dims.width}cm Ã— ${item.dims.projection||item.dims.height||0}cm\n`;
    b+=`\n`;
    const p = item.productionData;
    if(p && p.type==='antirides'){
      b+=`-- Î£Î™Î”Î—Î¡ÎŸÎšÎ‘Î¤Î‘Î£ÎšÎ•Î¥Î— --\n`;
      if(p.mechanism)     b+=`ÎœÎ·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒÏ‚: ${p.mechanism}\n`;
      if(p.kouzineto)     b+=`ÎšÎ¿Ï…Î¶Î¹Î½Î­Ï„Î¿: ${p.kouzineto}\n`;
      b+=`Î†Î¾Î¿Î½Î±Ï‚: ${p.axon} â€” ${p.axonCm.toFixed(1)}cm\n`;
      b+=`Î‘Î½Ï„Î¯Î²Î±ÏÎ¿: ${p.antivaro} â€” ${p.antivaroCm.toFixed(1)}cm\n`;
      b+=`Î£ÎµÏ„ Î‘Î½Ï„Î¹ÏÎ¯Î´Î±Ï‚: ${p.numSeta} ÏƒÎµÏ„\n`;
      b+=`ÎšÎ¿Î»Î¿Î½Î¬ÎºÎ¹: ${p.numSeta} Ï„ÎµÎ¼.\n`;
      b+=`Î£Ï‰Î»Î®Î½Î± Î‘Î»Î¿Ï…Î¼Î¹Î½Î¯Î¿Ï…: ${p.numSeta} Ã— ${p.solinaCm}cm\n`;
      if(p.strifonia)     b+=`Î£Ï„ÏÎ¹Ï†ÏÎ½Î¹Î±: ${p.strifonia}\n`;
      if(p.oupa)          b+=`ÎŸÏÏ€Î±: ${p.oupa}\n`;
      b+=`Î¤Î¬Ï€ÎµÏ‚: ${p.tapes}\n`;
      if(p.manivela)      b+=`ÎœÎ±Î½Î¹Î²Î­Î»Î±: ${p.manivela}\n`;
      if(p.xouftaAloum)   b+=`Î§Î¿ÏÏ†Ï„Î± Î‘Î»Î¿Ï…Î¼Î¹Î½Î¯Î¿Ï…: ${p.xouftaAloum}\n`;
      if(p.xouftaImanta)  b+=`Î§Î¿ÏÏ†Ï„Î± Î™Î¼Î¬Î½Ï„Î±Ï‚: ${p.xouftaImanta}\n`;
      if(p.thiki)         b+=`Î˜Î®ÎºÎ·: ${p.thiki}\n`;
      if(p.glossa)        b+=`Î“Î»ÏÏƒÏƒÎ±: ${p.glossa}\n`;
      if(p.typosGlossis)  b+=`Î¤ÏÏ€Î¿Ï‚ Î“Î»ÏÏƒÏƒÎ±Ï‚: ${p.typosGlossis}\n`;
      b+=`\n-- ÎšÎŸÎ Î•Î£ Î¥Î¦Î‘Î£ÎœÎ‘Î¤ÎŸÎ£ --\n`;
      b+=`Î¥Ï†Î¬ÏƒÎ¼Î±: ${p.fabric}\n`;
      b+=`Î Î»Î¬Ï„Î¿Ï‚: ${p.fabricWidth.toFixed(1)}cm\n`;
      b+=`ÎÏˆÎ¿Ï‚: ${p.fabricHeight}cm\n`;
      b+=`Î¦ÏÎ»Î»Î±: ${p.sheets} Ï†ÏÎ»Î»Î± Ã— ${p.fabricHeight}cm\n`;
      if(p.tsonta>0) b+=`Î¤ÏƒÏŒÎ½Ï„Î±: ${p.tsonta.toFixed(1)}cm Ã— ${p.fabricHeight}cm\n`;
    } else if(p && p.type==='yfasma'){
      b+=`-- ÎšÎŸÎ Î•Î£ Î¥Î¦Î‘Î£ÎœÎ‘Î¤ÎŸÎ£ --\n`;
      b+=`Î¥Ï†Î¬ÏƒÎ¼Î±: ${p.fabric}\n`;
      b+=`Î Î»Î¬Ï„Î¿Ï‚: ${p.fabricWidth}cm\n`;
      b+=`ÎÏˆÎ¿Ï‚: ${p.fabricHeight}cm\n`;
      b+=`Î¦ÏÎ»Î»Î±: ${p.sheets} Ï†ÏÎ»Î»Î± Ã— ${p.fabricHeight}cm\n`;
      if(p.tsonta>0) b+=`Î¤ÏƒÏŒÎ½Ï„Î±: ${p.tsonta.toFixed(1)}cm Ã— ${p.fabricHeight}cm\n`;
    } else {
      b+=`Î¥Ï†Î¬ÏƒÎ¼Î±: ${item.fabric||'â€”'}\n`;
    }
    if(item.notes) b+=`\nÎ£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚: ${item.notes}\n`;
    b+=`\n`;
  });
  if(notes) b+=`=== Î“Î•ÎÎ™ÎšÎ•Î£ Î£Î—ÎœÎ•Î™Î©Î£Î•Î™Î£ ===\n${notes}\n`;

  const subj=encodeURIComponent(`[Î Î‘Î¡Î‘Î“Î©Î“Î—] ${currentOfferNum} - ${first} ${last}`);
  _openMailto(`mailto:${BUSINESS_EMAIL}?subject=${subj}&body=${encodeURIComponent(b)}`);
  const btn=document.getElementById('prod-btn');
  btn.disabled=true; btn.textContent='âœ… Î•ÏƒÏ„Î¬Î»Î· ÏƒÏ„Î·Î½ Î Î±ÏÎ±Î³Ï‰Î³Î®';
}

function confirmAndSend(){ sendToCustomer(); }
function sendEmail(){ sendToCustomer(); }


function newOffer(){
  cart=[]; currentProduct=null; priceCalculated=false; currentOfferNum=null; lastCalcResult=null;
  sel={mechanism:null,axonas:null,fabric:null,manivela:null,thiki:null,glossa:null,typosGlossis:null};
  opt={entatiras:false,motor:false,xoufta:false,xouftaImanta:false};
  ['c-first','c-last','c-company','c-email','c-mobile','c-phone','c-address','c-city','c-afm','c-notes']
    .forEach(id=>document.getElementById(id).value='');
  clearState();
  renderCart(); goTo('customer');
}

// ===== localStorage persistence =====
const LS_KEY = 'offerApp_v1';

function saveState(){
  const fields={};
  ['c-first','c-last','c-company','c-email','c-mobile','c-phone','c-address','c-city','c-afm','c-notes']
    .forEach(id=>{ const el=document.getElementById(id); if(el) fields[id]=el.value; });
  try {
    localStorage.setItem(LS_KEY, JSON.stringify({ cart, fields, currentOfferNum, offerCounter }));
  } catch(e){}
}

function clearState(){
  try { localStorage.removeItem(LS_KEY); } catch(e){}
}

function restoreState(){
  try {
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return false;
    const s = JSON.parse(raw);
    if(s.cart && s.cart.length){
      cart = s.cart;
      offerCounter = s.offerCounter || offerCounter;
      currentOfferNum = s.currentOfferNum || null;
    }
    if(s.fields){
      Object.entries(s.fields).forEach(([id,val])=>{
        const el=document.getElementById(id); if(el) el.value=val;
      });
    }
    return !!(s.fields && (s.fields['c-first'] || s.fields['c-last']));
  } catch(e){ return false; }
}

loadDB();
</script>
</body>
</html>
